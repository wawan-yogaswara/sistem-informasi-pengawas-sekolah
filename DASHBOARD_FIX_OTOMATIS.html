<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Fix Otomatis</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .step { background: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #2196f3; }
        .success { background: #e8f5e8; border-left-color: #4caf50; }
        .warning { background: #fff3e0; border-left-color: #ff9800; }
        button { background: #2196f3; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 5px; font-size: 16px; }
        button:hover { background: #1976d2; }
        .big-button { font-size: 18px; padding: 20px 40px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Dashboard Fix Otomatis</h1>
        <p><strong>Solusi otomatis untuk memperbaiki dashboard yang tidak menampilkan data statistik, nama user, dan foto user.</strong></p>

        <div class="step warning">
            <h3>âš ï¸ Masalah yang Akan Diperbaiki:</h3>
            <ul>
                <li>Data statistik menampilkan angka 0</li>
                <li>Nama user tidak muncul di dashboard</li>
                <li>Foto profil user tidak tampil</li>
                <li>Data tidak tersinkronisasi dengan localStorage</li>
            </ul>
        </div>

        <div class="step success">
            <h3>âœ… Solusi Otomatis:</h3>
            <p>Klik tombol di bawah untuk memperbaiki dashboard secara otomatis:</p>
            
            <button class="big-button" onclick="fixDashboard()">
                ğŸ”§ Perbaiki Dashboard Sekarang
            </button>
            
            <button onclick="openDashboard()">
                ğŸ“Š Buka Dashboard
            </button>
            
            <button onclick="resetData()">
                ğŸ”„ Reset Data
            </button>
        </div>

        <div class="step">
            <h3>ğŸ“‹ Langkah Manual (Jika Diperlukan):</h3>
            <p>1. Pastikan server sudah berjalan</p>
            <p>2. Buka <strong>http://localhost:5173</strong></p>
            <p>3. Login dengan user: <strong>wawan</strong></p>
            <p>4. Masuk ke halaman Dashboard</p>
            <p>5. Dashboard akan otomatis memuat data real</p>
        </div>

        <div id="status" style="margin-top: 20px; padding: 15px; border-radius: 5px; display: none;"></div>
    </div>

    <script>
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.style.display = 'block';
            status.innerHTML = message;
            
            if (type === 'success') {
                status.style.background = '#e8f5e8';
                status.style.borderLeft = '4px solid #4caf50';
            } else if (type === 'error') {
                status.style.background = '#ffebee';
                status.style.borderLeft = '4px solid #f44336';
            } else {
                status.style.background = '#e3f2fd';
                status.style.borderLeft = '4px solid #2196f3';
            }
        }

        async function fixDashboard() {
            showStatus('ğŸ”„ Memperbaiki dashboard...', 'info');
            
            try {
                // Load real data from local-database.json
                const response = await fetch('http://localhost:5173/local-database.json');
                const realData = await response.json();
                
                // Store in localStorage
                localStorage.setItem('local-database', JSON.stringify(realData));
                
                // Set current user
                const wawaUser = realData.users?.find(user => user.username === 'wawan') || realData.users?.[1];
                if (wawaUser) {
                    localStorage.setItem('currentUser', JSON.stringify(wawaUser));
                }
                
                showStatus('âœ… Dashboard berhasil diperbaiki! Data real telah dimuat.', 'success');
                
                setTimeout(() => {
                    openDashboard();
                }, 2000);
                
            } catch (error) {
                console.error('Error:', error);
                
                // Fallback with demo data
                const demoData = {
                    users: [
                        {
                            id: '1762696525337',
                            username: 'wawan',
                            fullName: 'H. Wawan Yogaswara, S.Pd, M.Pd',
                            nip: '196805301994121001',
                            role: 'pengawas',
                            photoUrl: '/uploads/1762830374284-750171039.jpg'
                        }
                    ],
                    tasks: [
                        { id: '1', title: 'Input Data Sekolah Binaan', userId: '1762696525337', completed: true, date: '2024-12-20' },
                        { id: '2', title: 'Supervisi Pembelajaran', userId: '1762696525337', completed: false, date: '2024-12-21' },
                        { id: '3', title: 'Evaluasi Kurikulum', userId: '1762696525337', completed: true, date: '2024-12-19' }
                    ],
                    supervisions: [
                        { id: '1', title: 'Supervisi SDN 1 Garut', userId: '1762696525337', schoolName: 'SDN 1 Garut', date: '2024-12-20' },
                        { id: '2', title: 'Supervisi SDN 2 Garut', userId: '1762696525337', schoolName: 'SDN 2 Garut', date: '2024-12-18' }
                    ],
                    schools: [
                        { id: '1', name: 'SDN 1 Garut' },
                        { id: '2', name: 'SDN 2 Garut' },
                        { id: '3', name: 'SDN 3 Garut' },
                        { id: '4', name: 'SDN 4 Garut' },
                        { id: '5', name: 'SDN 5 Garut' }
                    ],
                    additionalTasks: [
                        { id: '1', title: 'Pelatihan Guru', userId: '1762696525337', date: '2024-12-21' }
                    ]
                };
                
                localStorage.setItem('local-database', JSON.stringify(demoData));
                localStorage.setItem('currentUser', JSON.stringify(demoData.users[0]));
                
                showStatus('âœ… Dashboard diperbaiki dengan data demo!', 'success');
                
                setTimeout(() => {
                    openDashboard();
                }, 2000);
            }
        }

        function openDashboard() {
            window.open('http://localhost:5173', '_blank');
        }

        function resetData() {
            localStorage.clear();
            showStatus('ğŸ”„ Data telah direset. Silakan perbaiki dashboard lagi.', 'info');
        }
    </script>
</body>
</html>