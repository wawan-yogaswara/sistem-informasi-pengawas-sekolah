<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç DIAGNOSA: Port 5173 Halaman Kosong</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: linear-gradient(135deg, #dc2626 0%, #7f1d1d 100%);
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        .success { color: #16a34a; background: #dcfce7; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #16a34a; }
        .error { color: #dc2626; background: #fef2f2; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #dc2626; }
        .warning { color: #d97706; background: #fef3c7; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #d97706; }
        .info { color: #2563eb; background: #dbeafe; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #2563eb; }
        button {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 8px;
            transition: all 0.3s;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .btn-success { background: linear-gradient(135deg, #16a34a 0%, #15803d 100%); }
        .btn-warning { background: linear-gradient(135deg, #d97706 0%, #b45309 100%); }
        .btn-info { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); }
        pre { background: #1f2937; color: #f9fafb; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 12px; }
        .step { background: #f8fafc; padding: 20px; margin: 15px 0; border-radius: 10px; border: 2px solid #e2e8f0; }
        .step h3 { margin-top: 0; color: #1e293b; }
        iframe { width: 100%; height: 400px; border: 2px solid #e2e8f0; border-radius: 8px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç DIAGNOSA MENDALAM: Port 5173 Halaman Kosong</h1>
        
        <div class="error">
            <h3>üö® MASALAH TERIDENTIFIKASI</h3>
            <p>Port 5173 dapat diakses tapi menampilkan halaman kosong. Kemungkinan penyebab:</p>
            <ul>
                <li>React tidak mounting ke DOM</li>
                <li>JavaScript error yang mencegah rendering</li>
                <li>CSS yang menyembunyikan konten</li>
                <li>Routing issue atau infinite redirect</li>
                <li>Authentication logic yang bermasalah</li>
            </ul>
        </div>

        <div class="step">
            <h3>üîç Step 1: Test Direct Access</h3>
            <button onclick="testDirectAccess()" class="btn-info">üåê Test Direct Access</button>
            <button onclick="showInIframe()" class="btn-warning">üì± Show in iFrame</button>
            <div id="accessResult"></div>
            <div id="iframeContainer"></div>
        </div>

        <div class="step">
            <h3>üß™ Step 2: Inject Test Content</h3>
            <button onclick="injectTestContent()" class="btn-success">üíâ Inject Test HTML</button>
            <button onclick="testReactMount()" class="btn-info">‚öõÔ∏è Test React Mount</button>
            <div id="injectResult"></div>
        </div>

        <div class="step">
            <h3>üîß Step 3: Check Console Errors</h3>
            <button onclick="checkConsoleErrors()" class="btn-warning">üêõ Check Console</button>
            <button onclick="showNetworkRequests()" class="btn-info">üåê Check Network</button>
            <div id="consoleResult"></div>
        </div>

        <div class="step">
            <h3>üîë Step 4: Authentication Bypass</h3>
            <button onclick="bypassAuth()" class="btn-success">üîì Bypass Auth</button>
            <button onclick="clearAllData()" class="btn-warning">üóëÔ∏è Clear All Data</button>
            <button onclick="forceLogin()" class="btn-info">üîê Force Login</button>
            <div id="authResult"></div>
        </div>

        <div class="step">
            <h3>üöÄ Step 5: Emergency Fixes</h3>
            <button onclick="emergencyReload()" class="btn-warning">üîÑ Emergency Reload</button>
            <button onclick="openNewWindow()" class="btn-success">ü™ü Open New Window</button>
            <button onclick="showManualSteps()" class="btn-info">üìã Manual Steps</button>
            <div id="emergencyResult"></div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info';
            element.innerHTML += `<div class="${className}">${message}</div>`;
        }

        async function testDirectAccess() {
            showResult('accessResult', 'üîÑ Testing direct access to localhost:5173...', 'info');
            
            try {
                const response = await fetch('http://localhost:5173/', {
                    method: 'GET',
                    headers: {
                        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
                    }
                });
                
                if (response.ok) {
                    const html = await response.text();
                    showResult('accessResult', `‚úÖ Server accessible! Status: ${response.status}`, 'success');
                    
                    // Analyze HTML content
                    if (html.includes('<div id="root">')) {
                        showResult('accessResult', '‚úÖ HTML contains root div', 'success');
                    } else {
                        showResult('accessResult', '‚ùå HTML missing root div', 'error');
                    }
                    
                    if (html.includes('main.tsx')) {
                        showResult('accessResult', '‚úÖ HTML references main.tsx', 'success');
                    } else {
                        showResult('accessResult', '‚ùå HTML missing main.tsx reference', 'error');
                    }
                    
                    // Show HTML preview
                    const preview = html.substring(0, 1000);
                    showResult('accessResult', `<strong>HTML Preview:</strong><pre>${preview}...</pre>`, 'info');
                    
                } else {
                    showResult('accessResult', `‚ùå Server error: ${response.status}`, 'error');
                }
            } catch (error) {
                showResult('accessResult', `‚ùå Connection failed: ${error.message}`, 'error');
            }
        }

        function showInIframe() {
            const container = document.getElementById('iframeContainer');
            container.innerHTML = `
                <div class="info">
                    <h4>üì± iFrame Test:</h4>
                    <iframe src="http://localhost:5173/" title="Port 5173 Test"></iframe>
                    <p>Jika iFrame di atas kosong, berarti ada masalah dengan React mounting atau JavaScript error.</p>
                </div>
            `;
        }

        function injectTestContent() {
            showResult('injectResult', 'üíâ Injecting test content...', 'info');
            
            // Create test script to inject into localhost:5173
            const testScript = `
                // Emergency test content injection
                console.log('üß™ EMERGENCY TEST INJECTION STARTED');
                
                // Test 1: Check if root element exists
                const rootElement = document.getElementById('root');
                if (rootElement) {
                    console.log('‚úÖ Root element found:', rootElement);
                    
                    // Test 2: Inject test content
                    rootElement.innerHTML = \`
                        <div style="padding: 50px; text-align: center; background: linear-gradient(135deg, #16a34a 0%, #15803d 100%); color: white; border-radius: 15px; margin: 20px;">
                            <h1 style="margin: 0 0 20px 0;">üéâ EMERGENCY TEST BERHASIL!</h1>
                            <p style="font-size: 18px; margin: 10px 0;">Jika Anda melihat ini, berarti HTML injection berhasil.</p>
                            <p style="opacity: 0.8;">Timestamp: \${new Date().toLocaleString()}</p>
                            <button onclick="alert('Button works!')" style="background: white; color: #16a34a; padding: 15px 30px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 20px;">Test Button</button>
                        </div>
                    \`;
                    
                    console.log('‚úÖ Test content injected successfully');
                } else {
                    console.error('‚ùå Root element not found');
                }
                
                // Test 3: Check for React
                if (typeof React !== 'undefined') {
                    console.log('‚úÖ React is available');
                } else {
                    console.log('‚ùå React not found');
                }
                
                console.log('üß™ EMERGENCY TEST INJECTION COMPLETED');
            `;
            
            showResult('injectResult', '‚úÖ Test script created. Copy and paste this in localhost:5173 console:', 'success');
            showResult('injectResult', `<pre>${testScript}</pre>`, 'info');
            showResult('injectResult', 'üìã Instructions: 1. Open localhost:5173, 2. Press F12, 3. Paste script in Console tab', 'warning');
        }

        function testReactMount() {
            showResult('injectResult', '‚öõÔ∏è Testing React mounting...', 'info');
            
            const reactTest = `
                // React mounting test
                console.log('üîç REACT MOUNTING TEST');
                
                // Check if React DevTools are available
                if (window.__REACT_DEVTOOLS_GLOBAL_HOOK__) {
                    console.log('‚úÖ React DevTools detected');
                } else {
                    console.log('‚ùå React DevTools not found');
                }
                
                // Check for React fiber
                const rootElement = document.getElementById('root');
                if (rootElement && rootElement._reactInternalFiber) {
                    console.log('‚úÖ React fiber found');
                } else if (rootElement && rootElement._reactInternalInstance) {
                    console.log('‚úÖ React instance found');
                } else {
                    console.log('‚ùå No React mounting detected');
                }
                
                // Check for any React components
                const reactElements = document.querySelectorAll('[data-reactroot], [data-react-helmet]');
                console.log('React elements found:', reactElements.length);
                
                // Force React error boundary test
                try {
                    if (window.React) {
                        console.log('‚úÖ React global available');
                    }
                } catch (e) {
                    console.error('‚ùå React error:', e);
                }
            `;
            
            showResult('injectResult', '<pre>' + reactTest + '</pre>', 'info');
        }

        function checkConsoleErrors() {
            showResult('consoleResult', 'üêõ Checking for console errors...', 'info');
            
            const consoleCheck = `
                // Console error checker
                console.log('üîç CONSOLE ERROR CHECK');
                
                // Override console methods to capture errors
                const originalError = console.error;
                const originalWarn = console.warn;
                const errors = [];
                const warnings = [];
                
                console.error = function(...args) {
                    errors.push(args.join(' '));
                    originalError.apply(console, args);
                };
                
                console.warn = function(...args) {
                    warnings.push(args.join(' '));
                    originalWarn.apply(console, args);
                };
                
                // Check for existing errors
                setTimeout(() => {
                    console.log('üìä Error Summary:');
                    console.log('Errors found:', errors.length);
                    console.log('Warnings found:', warnings.length);
                    
                    if (errors.length > 0) {
                        console.log('‚ùå Errors:', errors);
                    }
                    
                    if (warnings.length > 0) {
                        console.log('‚ö†Ô∏è Warnings:', warnings);
                    }
                    
                    // Check for network errors
                    const failedRequests = performance.getEntriesByType('navigation').concat(performance.getEntriesByType('resource')).filter(entry => entry.transferSize === 0);
                    console.log('üåê Failed requests:', failedRequests.length);
                    
                }, 3000);
            `;
            
            showResult('consoleResult', '<pre>' + consoleCheck + '</pre>', 'info');
        }

        function showNetworkRequests() {
            showResult('consoleResult', 'üåê Network request checker:', 'info');
            
            const networkCheck = `
                // Network request checker
                console.log('üåê NETWORK REQUEST CHECK');
                
                // Check all network requests
                const entries = performance.getEntriesByType('resource');
                console.log('Total requests:', entries.length);
                
                const failed = entries.filter(entry => entry.transferSize === 0);
                console.log('Failed requests:', failed.length);
                
                if (failed.length > 0) {
                    console.log('‚ùå Failed requests:', failed.map(f => f.name));
                }
                
                // Check for main.tsx specifically
                const mainTsx = entries.find(entry => entry.name.includes('main.tsx'));
                if (mainTsx) {
                    console.log('‚úÖ main.tsx loaded:', mainTsx);
                } else {
                    console.log('‚ùå main.tsx not found in requests');
                }
                
                // Check for CSS files
                const cssFiles = entries.filter(entry => entry.name.includes('.css'));
                console.log('CSS files loaded:', cssFiles.length);
            `;
            
            showResult('consoleResult', '<pre>' + networkCheck + '</pre>', 'info');
        }

        function bypassAuth() {
            showResult('authResult', 'üîì Bypassing authentication...', 'info');
            
            // Set emergency auth in current window
            localStorage.clear();
            sessionStorage.clear();
            
            localStorage.setItem('auth_token', 'emergency-bypass-' + Date.now());
            localStorage.setItem('user_data', JSON.stringify({
                id: 'emergency-admin',
                username: 'admin',
                fullName: 'Emergency Administrator',
                role: 'admin',
                nip: '999999999',
                email: 'admin@emergency.local'
            }));
            
            showResult('authResult', '‚úÖ Emergency auth set in current window', 'success');
            showResult('authResult', 'üåê Opening localhost:5173 with auth...', 'info');
            
            setTimeout(() => {
                window.open('http://localhost:5173?bypass=true&t=' + Date.now(), '_blank');
            }, 1000);
        }

        function clearAllData() {
            showResult('authResult', 'üóëÔ∏è Clearing all browser data...', 'warning');
            
            // Clear all storage
            localStorage.clear();
            sessionStorage.clear();
            
            // Clear cookies
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            
            // Clear caches
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            
            showResult('authResult', '‚úÖ All data cleared', 'success');
        }

        function forceLogin() {
            showResult('authResult', 'üîê Force login setup...', 'info');
            
            const loginScript = `
                // Force login script
                console.log('üîê FORCE LOGIN SCRIPT');
                
                // Set auth data
                localStorage.setItem('auth_token', 'force-login-' + Date.now());
                localStorage.setItem('user_data', JSON.stringify({
                    id: 'force-admin',
                    username: 'admin',
                    fullName: 'Force Login Admin',
                    role: 'admin'
                }));
                
                // Force redirect to dashboard
                if (window.location.pathname === '/login' || window.location.pathname === '/') {
                    window.location.href = '/dashboard';
                }
                
                // Force reload
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            `;
            
            showResult('authResult', '<pre>' + loginScript + '</pre>', 'info');
        }

        function emergencyReload() {
            showResult('emergencyResult', 'üîÑ Emergency reload...', 'warning');
            window.location.reload(true);
        }

        function openNewWindow() {
            showResult('emergencyResult', 'ü™ü Opening new window...', 'info');
            const newWindow = window.open('http://localhost:5173', '_blank', 'width=1200,height=800');
            
            setTimeout(() => {
                if (newWindow) {
                    newWindow.localStorage.setItem('auth_token', 'new-window-' + Date.now());
                    newWindow.localStorage.setItem('user_data', JSON.stringify({
                        id: 'new-window-admin',
                        username: 'admin',
                        fullName: 'New Window Admin',
                        role: 'admin'
                    }));
                    newWindow.location.reload();
                }
            }, 2000);
        }

        function showManualSteps() {
            showResult('emergencyResult', `
                <div class="warning">
                    <h4>üìã Manual Steps:</h4>
                    <ol>
                        <li><strong>Open localhost:5173 in new tab</strong></li>
                        <li><strong>Press F12</strong> to open Developer Tools</li>
                        <li><strong>Check Console tab</strong> for red errors</li>
                        <li><strong>Check Network tab</strong> for failed requests</li>
                        <li><strong>Check Elements tab</strong> - is root div empty?</li>
                        <li><strong>Paste emergency script</strong> from above</li>
                        <li><strong>Try different browser</strong> (Chrome, Firefox, Edge)</li>
                        <li><strong>Try incognito mode</strong></li>
                    </ol>
                </div>
            `, 'warning');
        }

        // Auto-start diagnosis
        window.onload = function() {
            setTimeout(testDirectAccess, 1000);
        };
    </script>
</body>
</html>