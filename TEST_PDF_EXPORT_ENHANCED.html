<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Enhanced PDF Export - Laporan Pengawas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #2563eb;
        }
        
        .header h1 {
            color: #2563eb;
            margin-bottom: 10px;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
        }
        
        .test-section h3 {
            color: #374151;
            margin-bottom: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: #2563eb;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1d4ed8;
        }
        
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        
        .btn-outline {
            background-color: transparent;
            color: #2563eb;
            border: 2px solid #2563eb;
        }
        
        .btn-outline:hover {
            background-color: #2563eb;
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2563eb;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #64748b;
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .log-area {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .success {
            color: #10b981;
        }
        
        .error {
            color: #ef4444;
        }
        
        .warning {
            color: #f59e0b;
        }
        
        .info {
            color: #3b82f6;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background: white;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .container {
                box-shadow: none;
                border: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Test Enhanced PDF Export</h1>
            <p>Pengujian fungsi ekspor PDF yang telah diperbaiki untuk halaman laporan</p>
        </div>

        <div class="test-section">
            <h3>üìä Data Sample untuk Testing</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">5</div>
                    <div class="stat-label">Total Tugas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">4</div>
                    <div class="stat-label">Tugas Selesai</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">3</div>
                    <div class="stat-label">Supervisi</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">6</div>
                    <div class="stat-label">Tugas Tambahan</div>
                </div>
            </div>
        </div>

        <div class="test-section no-print">
            <h3>üîß Test PDF Export Methods</h3>
            <p>Klik tombol di bawah untuk menguji berbagai metode ekspor PDF:</p>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="testEnhancedPDFExport()">
                    üìÑ Test Enhanced PDF Export
                </button>
                
                <button class="btn btn-secondary" onclick="testWindowOpenMethod()">
                    ü™ü Test Window.open Method
                </button>
                
                <button class="btn btn-outline" onclick="testIframeMethod()">
                    üñºÔ∏è Test Iframe Method
                </button>
                
                <button class="btn btn-outline" onclick="testDirectPrint()">
                    üñ®Ô∏è Test Direct Print
                </button>
            </div>
            
            <div id="log" class="log-area">
                <div class="info">üìã Log akan muncul di sini...</div>
            </div>
        </div>

        <div class="test-section">
            <h3>üìã Ringkasan Kegiatan Bulan Ini</h3>
            <ul>
                <li>‚úÖ Total 5 tugas pokok tercatat dalam periode ini</li>
                <li>‚úÖ 4 tugas telah diselesaikan dengan baik (80% completion rate)</li>
                <li>‚úÖ 3 kegiatan supervisi telah dilaksanakan</li>
                <li>‚úÖ Mengikuti 6 kegiatan tambahan dan pengembangan</li>
                <li>‚úÖ Semua kegiatan dilaksanakan sesuai dengan rencana kerja</li>
                <li>‚úÖ Dokumentasi dan pelaporan kegiatan telah dilakukan secara tertib</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üìù Tanda Tangan</h3>
            <div style="text-align: right; margin-top: 40px;">
                <div>Bandung, <span id="currentDate"></span></div>
                <div style="margin: 20px 0 60px 0;">Pengawas Sekolah,</div>
                <div style="border-bottom: 2px solid #333; display: inline-block; min-width: 200px; text-align: center; padding-bottom: 5px;">
                    <strong>Administrator</strong>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Set current date
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('id-ID', {
            day: 'numeric',
            month: 'long', 
            year: 'numeric'
        });

        // Logging function
        function log(message, type = 'info') {
            const logArea = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        // Sample data for testing
        const sampleStats = {
            totalTasks: 5,
            completedTasks: 4,
            supervisions: 3,
            additionalTasks: 6
        };

        const period = new Date().toLocaleDateString('id-ID', { year: 'numeric', month: 'long' });

        // Generate PDF HTML content (same as in reports.tsx)
        function generatePDFHTML(stats, period) {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Laporan Kegiatan Pengawas - ${period}</title>
                    <style>
                        @page { size: A4; margin: 20mm; }
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: 'Times New Roman', serif; line-height: 1.6; color: #333; padding: 20px; background: white; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #000; padding-bottom: 20px; }
                        .header h1 { font-size: 20px; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
                        .header h2 { font-size: 16px; font-weight: normal; color: #666; }
                        .stats-section { margin: 30px 0; }
                        .stats-title { font-size: 16px; font-weight: bold; margin-bottom: 20px; text-transform: uppercase; color: #333; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
                        .stats-grid { display: table; width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        .stats-row { display: table-row; }
                        .stat-item { display: table-cell; border: 2px solid #333; padding: 20px; text-align: center; width: 50%; vertical-align: middle; }
                        .stat-number { font-size: 28px; font-weight: bold; margin-bottom: 8px; color: #2563eb; }
                        .stat-label { font-size: 13px; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; }
                        .summary-section { margin: 40px 0; }
                        .summary-title { font-size: 16px; font-weight: bold; margin-bottom: 20px; text-transform: uppercase; color: #333; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
                        .summary-list { list-style: none; padding: 0; }
                        .summary-list li { margin-bottom: 12px; padding-left: 25px; position: relative; line-height: 1.8; }
                        .summary-list li:before { content: "‚úì"; position: absolute; left: 0; font-weight: bold; color: #16a34a; font-size: 16px; }
                        .signature-section { margin-top: 60px; text-align: right; }
                        .signature-date { margin-bottom: 15px; font-size: 14px; }
                        .signature-title { margin-bottom: 80px; font-size: 14px; font-weight: 600; }
                        .signature-name { font-weight: bold; border-bottom: 2px solid #333; display: inline-block; min-width: 250px; text-align: center; padding-bottom: 5px; font-size: 14px; }
                        .footer-note { margin-top: 40px; text-align: center; font-size: 12px; color: #666; font-style: italic; }
                        @media print { body { padding: 0; -webkit-print-color-adjust: exact; print-color-adjust: exact; } .no-print { display: none !important; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Laporan Kegiatan Pengawas Sekolah</h1>
                        <h2>Dinas Pendidikan Provinsi Jawa Barat</h2>
                        <h2>Periode: ${period}</h2>
                    </div>
                    <div class="stats-section">
                        <div class="stats-title">Ringkasan Statistik Kegiatan</div>
                        <div class="stats-grid">
                            <div class="stats-row">
                                <div class="stat-item">
                                    <div class="stat-number">${stats.totalTasks}</div>
                                    <div class="stat-label">Total Tugas Pokok</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">${stats.completedTasks}</div>
                                    <div class="stat-label">Tugas Selesai</div>
                                </div>
                            </div>
                            <div class="stats-row">
                                <div class="stat-item">
                                    <div class="stat-number">${stats.supervisions}</div>
                                    <div class="stat-label">Kegiatan Supervisi</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">${stats.additionalTasks}</div>
                                    <div class="stat-label">Tugas Tambahan</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="summary-section">
                        <div class="summary-title">Ringkasan Pencapaian Kegiatan</div>
                        <ul class="summary-list">
                            <li>Telah menyelesaikan ${stats.totalTasks} tugas pokok sesuai dengan rencana kerja yang ditetapkan</li>
                            <li>Tingkat penyelesaian tugas mencapai ${Math.round(((stats.completedTasks || 0) / (stats.totalTasks || 1)) * 100)}% dari target yang ditetapkan</li>
                            <li>Melaksanakan ${stats.supervisions} kegiatan supervisi ke sekolah-sekolah binaan</li>
                            <li>Berpartisipasi aktif dalam ${stats.additionalTasks} kegiatan pengembangan dan pelatihan</li>
                            <li>Semua kegiatan dilaksanakan dengan mengacu pada standar operasional prosedur yang berlaku</li>
                            <li>Dokumentasi dan pelaporan kegiatan telah dilakukan secara tertib dan tepat waktu</li>
                            <li>Koordinasi dengan pihak terkait berjalan dengan baik dan lancar</li>
                        </ul>
                    </div>
                    <div class="signature-section">
                        <div class="signature-date">Bandung, ${new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
                        <div class="signature-title">Pengawas Sekolah,</div>
                        <div class="signature-name">Administrator</div>
                    </div>
                    <div class="footer-note">
                        Laporan ini dibuat secara otomatis melalui Sistem Informasi Pengawas Sekolah<br>
                        Dinas Pendidikan Provinsi Jawa Barat
                    </div>
                </body>
                </html>
            `;
        }

        // Test Enhanced PDF Export (same as in reports.tsx)
        function testEnhancedPDFExport() {
            log('üîÑ Starting enhanced PDF export test...', 'info');
            
            try {
                // Method 1: Try window.open first
                const tryWindowOpen = () => {
                    log('ü™ü Trying window.open method...', 'info');
                    const printWindow = window.open('', '_blank', 'width=800,height=600');
                    if (!printWindow) {
                        log('‚ùå Window.open blocked by browser', 'warning');
                        return false;
                    }
                    
                    printWindow.document.write(generatePDFHTML(sampleStats, period));
                    printWindow.document.close();
                    
                    setTimeout(() => {
                        printWindow.focus();
                        printWindow.print();
                        setTimeout(() => {
                            if (!printWindow.closed) {
                                printWindow.close();
                            }
                        }, 1000);
                    }, 500);
                    
                    log('‚úÖ Window.open method successful', 'success');
                    return true;
                };
                
                // Method 2: Fallback to iframe
                const tryIframeMethod = () => {
                    log('üñºÔ∏è Trying iframe fallback method...', 'info');
                    const iframe = document.createElement('iframe');
                    iframe.style.position = 'fixed';
                    iframe.style.right = '0';
                    iframe.style.bottom = '0';
                    iframe.style.width = '0';
                    iframe.style.height = '0';
                    iframe.style.border = '0';
                    document.body.appendChild(iframe);
                    
                    const iframeDoc = iframe.contentWindow?.document;
                    if (!iframeDoc) {
                        throw new Error('Cannot create iframe document');
                    }
                    
                    iframeDoc.open();
                    iframeDoc.write(generatePDFHTML(sampleStats, period));
                    iframeDoc.close();
                    
                    setTimeout(() => {
                        try {
                            iframe.contentWindow?.focus();
                            iframe.contentWindow?.print();
                            setTimeout(() => {
                                if (document.body.contains(iframe)) {
                                    document.body.removeChild(iframe);
                                }
                            }, 1000);
                            log('‚úÖ Iframe method successful', 'success');
                        } catch (printError) {
                            log('‚ùå Iframe print error: ' + printError.message, 'error');
                            if (document.body.contains(iframe)) {
                                document.body.removeChild(iframe);
                            }
                        }
                    }, 500);
                };
                
                // Try window.open first, fallback to iframe
                if (!tryWindowOpen()) {
                    tryIframeMethod();
                }
                
            } catch (error) {
                log('‚ùå Enhanced PDF export error: ' + error.message, 'error');
            }
        }

        // Test Window.open Method
        function testWindowOpenMethod() {
            log('ü™ü Testing window.open method only...', 'info');
            
            const printWindow = window.open('', '_blank', 'width=800,height=600');
            if (!printWindow) {
                log('‚ùå Window.open blocked by browser', 'error');
                return;
            }
            
            printWindow.document.write(generatePDFHTML(sampleStats, period));
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.focus();
                printWindow.print();
                log('‚úÖ Window.open method completed', 'success');
            }, 500);
        }

        // Test Iframe Method
        function testIframeMethod() {
            log('üñºÔ∏è Testing iframe method only...', 'info');
            
            const iframe = document.createElement('iframe');
            iframe.style.position = 'fixed';
            iframe.style.right = '0';
            iframe.style.bottom = '0';
            iframe.style.width = '0';
            iframe.style.height = '0';
            iframe.style.border = '0';
            document.body.appendChild(iframe);
            
            const iframeDoc = iframe.contentWindow?.document;
            if (!iframeDoc) {
                log('‚ùå Cannot create iframe document', 'error');
                return;
            }
            
            iframeDoc.open();
            iframeDoc.write(generatePDFHTML(sampleStats, period));
            iframeDoc.close();
            
            setTimeout(() => {
                try {
                    iframe.contentWindow?.focus();
                    iframe.contentWindow?.print();
                    setTimeout(() => {
                        if (document.body.contains(iframe)) {
                            document.body.removeChild(iframe);
                        }
                    }, 1000);
                    log('‚úÖ Iframe method completed', 'success');
                } catch (error) {
                    log('‚ùå Iframe print error: ' + error.message, 'error');
                    if (document.body.contains(iframe)) {
                        document.body.removeChild(iframe);
                    }
                }
            }, 500);
        }

        // Test Direct Print
        function testDirectPrint() {
            log('üñ®Ô∏è Testing direct print method...', 'info');
            window.print();
            log('‚úÖ Direct print method completed', 'success');
        }

        // Clear log
        function clearLog() {
            document.getElementById('log').innerHTML = '<div class="info">üìã Log cleared...</div>';
        }

        // Initial log
        log('üöÄ PDF Export Test Page loaded successfully', 'success');
        log('üìä Sample data ready for testing', 'info');
        log('üîß Click any test button to begin', 'info');
    </script>
</body>
</html>