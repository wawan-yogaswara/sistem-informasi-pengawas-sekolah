<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Fix PDF Export - Immediate Solution</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8fafc;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #2563eb;
        }
        
        .header h1 {
            color: #2563eb;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .alert {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .alert h3 {
            color: #92400e;
            margin-bottom: 10px;
        }
        
        .solution-box {
            background: #ecfdf5;
            border: 2px solid #10b981;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .solution-box h3 {
            color: #047857;
            margin-bottom: 15px;
        }
        
        .test-button {
            display: inline-block;
            padding: 15px 30px;
            margin: 10px;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        }
        
        .test-button.secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }
        
        .test-button.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .step {
            background: #f1f5f9;
            border-left: 4px solid #2563eb;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .step h4 {
            color: #1e40af;
            margin-bottom: 10px;
        }
        
        .code-block {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .stats-demo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #cbd5e1;
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2563eb;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #64748b;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .log-area {
            background: #1f2937;
            color: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            border: 2px solid #374151;
        }
        
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
        
        .popup-instructions {
            background: #fef2f2;
            border: 2px solid #f87171;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .popup-instructions h3 {
            color: #dc2626;
            margin-bottom: 15px;
        }
        
        .popup-instructions ol {
            color: #7f1d1d;
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Fix PDF Export</h1>
            <p>Solusi Immediate untuk Masalah Ekspor PDF</p>
        </div>

        <div class="alert">
            <h3>‚ö†Ô∏è Masalah yang Teridentifikasi</h3>
            <p>Tombol "Ekspor ke PDF" tidak berfungsi karena browser memblokir popup. Ini adalah masalah umum pada aplikasi web modern.</p>
        </div>

        <div class="solution-box">
            <h3>‚úÖ Solusi Immediate</h3>
            <p>Gunakan metode alternatif yang pasti bekerja di semua browser tanpa perlu mengubah kode aplikasi.</p>
        </div>

        <div class="stats-demo">
            <div class="stat-card">
                <div class="stat-number">3</div>
                <div class="stat-label">Total Tugas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">2</div>
                <div class="stat-label">Tugas Selesai</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">3</div>
                <div class="stat-label">Supervisi</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">6</div>
                <div class="stat-label">Tugas Tambahan</div>
            </div>
        </div>

        <div style="text-align: center; margin: 40px 0;">
            <button class="test-button success" onclick="generateAndPrintPDF()">
                üìÑ Generate PDF Sekarang
            </button>
            
            <button class="test-button" onclick="testPopupBlocked()">
                üîç Test Popup Blocker
            </button>
            
            <button class="test-button secondary" onclick="showInstructions()">
                üìã Lihat Instruksi Manual
            </button>
        </div>

        <div class="step">
            <h4>üéØ Langkah 1: Test Popup Blocker</h4>
            <p>Klik tombol "Test Popup Blocker" untuk melihat apakah browser memblokir popup.</p>
        </div>

        <div class="step">
            <h4>üìÑ Langkah 2: Generate PDF</h4>
            <p>Klik tombol "Generate PDF Sekarang" untuk membuat PDF laporan dengan data sample.</p>
        </div>

        <div class="step">
            <h4>üñ®Ô∏è Langkah 3: Save as PDF</h4>
            <p>Ketika dialog print muncul, pilih "Save as PDF" sebagai printer destination.</p>
        </div>

        <div class="popup-instructions" id="instructions" style="display: none;">
            <h3>üìã Instruksi Manual untuk Aplikasi</h3>
            <ol>
                <li><strong>Buka halaman Laporan</strong> di aplikasi (localhost:5000/reports)</li>
                <li><strong>Tekan Ctrl+P</strong> (Windows) atau Cmd+P (Mac) untuk membuka dialog print</li>
                <li><strong>Pilih "Save as PDF"</strong> sebagai destination</li>
                <li><strong>Klik "More settings"</strong> dan pastikan:
                    <ul>
                        <li>Paper size: A4</li>
                        <li>Margins: Default</li>
                        <li>Options: Background graphics (checked)</li>
                    </ul>
                </li>
                <li><strong>Klik "Save"</strong> dan pilih lokasi file</li>
            </ol>
        </div>

        <div id="log" class="log-area">
            <div class="info">üìã Log akan muncul di sini...</div>
        </div>

        <div class="solution-box">
            <h3>üîß Solusi Permanent untuk Developer</h3>
            <div class="code-block">
// Tambahkan ini ke reports.tsx
const handleExportPDF = () => {
  // Method 1: Direct print (always works)
  window.print();
  
  // Method 2: Show instructions
  alert('Pilih "Save as PDF" di dialog print yang muncul');
};
            </div>
        </div>
    </div>

    <script>
        // Logging function
        function log(message, type = 'info') {
            const logArea = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        // Sample data
        const sampleStats = {
            totalTasks: 3,
            completedTasks: 2,
            supervisions: 3,
            additionalTasks: 6
        };

        const period = "Desember 2025";

        // Generate PDF HTML
        function generatePDFHTML(stats, period) {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Laporan Kegiatan Pengawas - ${period}</title>
                    <style>
                        @page { size: A4; margin: 20mm; }
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; padding: 20px; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #000; padding-bottom: 20px; }
                        .header h1 { font-size: 24px; margin-bottom: 10px; font-weight: bold; }
                        .header h2 { font-size: 18px; margin-bottom: 5px; }
                        .stats { display: table; width: 100%; border-collapse: collapse; margin: 30px 0; }
                        .stat-row { display: table-row; }
                        .stat-cell { display: table-cell; border: 2px solid #333; padding: 20px; text-align: center; width: 50%; }
                        .stat-number { font-size: 28px; font-weight: bold; color: #2563eb; margin-bottom: 8px; }
                        .stat-label { font-size: 14px; text-transform: uppercase; font-weight: 600; }
                        .summary { margin: 30px 0; }
                        .summary h3 { font-size: 18px; margin-bottom: 15px; }
                        .summary ul { line-height: 1.8; }
                        .signature { margin-top: 60px; text-align: right; }
                        .signature p { margin-bottom: 10px; }
                        .signature-line { border-bottom: 2px solid #000; display: inline-block; min-width: 250px; text-align: center; padding-bottom: 5px; margin-top: 60px; }
                        @media print { body { padding: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>LAPORAN KEGIATAN PENGAWAS SEKOLAH</h1>
                        <h2>Dinas Pendidikan Provinsi Jawa Barat</h2>
                        <h2>Periode: ${period}</h2>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-row">
                            <div class="stat-cell">
                                <div class="stat-number">${stats.totalTasks}</div>
                                <div class="stat-label">Total Tugas Pokok</div>
                            </div>
                            <div class="stat-cell">
                                <div class="stat-number">${stats.completedTasks}</div>
                                <div class="stat-label">Tugas Selesai</div>
                            </div>
                        </div>
                        <div class="stat-row">
                            <div class="stat-cell">
                                <div class="stat-number">${stats.supervisions}</div>
                                <div class="stat-label">Kegiatan Supervisi</div>
                            </div>
                            <div class="stat-cell">
                                <div class="stat-number">${stats.additionalTasks}</div>
                                <div class="stat-label">Tugas Tambahan</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="summary">
                        <h3>Ringkasan Pencapaian Kegiatan</h3>
                        <ul>
                            <li>Telah menyelesaikan ${stats.totalTasks} tugas pokok sesuai dengan rencana kerja yang ditetapkan</li>
                            <li>Tingkat penyelesaian tugas mencapai ${Math.round((stats.completedTasks/stats.totalTasks)*100)}% dari target yang ditetapkan</li>
                            <li>Melaksanakan ${stats.supervisions} kegiatan supervisi ke sekolah-sekolah binaan</li>
                            <li>Berpartisipasi aktif dalam ${stats.additionalTasks} kegiatan pengembangan dan pelatihan</li>
                            <li>Semua kegiatan dilaksanakan dengan mengacu pada standar operasional prosedur yang berlaku</li>
                            <li>Dokumentasi dan pelaporan kegiatan telah dilakukan secara tertib dan tepat waktu</li>
                            <li>Koordinasi dengan pihak terkait berjalan dengan baik dan lancar</li>
                        </ul>
                    </div>
                    
                    <div class="summary">
                        <h3>Kesimpulan</h3>
                        <p>Berdasarkan data kegiatan yang telah dilaksanakan, dapat disimpulkan bahwa pelaksanaan tugas pengawas sekolah berjalan dengan baik dan sesuai dengan rencana kerja yang telah ditetapkan. Tingkat pencapaian target menunjukkan kinerja yang memuaskan.</p>
                    </div>
                    
                    <div class="signature">
                        <p>Bandung, ${new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' })}</p>
                        <p>Pengawas Sekolah,</p>
                        <div class="signature-line">
                            <strong>Administrator</strong>
                        </div>
                    </div>
                </body>
                </html>
            `;
        }

        // Test popup blocker
        function testPopupBlocked() {
            log('üîç Testing popup blocker...', 'info');
            
            const testWindow = window.open('', '_blank', 'width=400,height=300');
            
            if (testWindow) {
                log('‚úÖ Popup NOT blocked - PDF export should work', 'success');
                testWindow.document.write('<h1>Popup Test Success!</h1><p>PDF export akan bekerja dengan baik.</p>');
                setTimeout(() => {
                    testWindow.close();
                }, 2000);
            } else {
                log('‚ùå Popup BLOCKED - Need to enable popups', 'error');
                log('üí° Solution: Allow popups for this site or use Print method', 'warning');
            }
        }

        // Generate and print PDF
        function generateAndPrintPDF() {
            log('üîÑ Generating PDF...', 'info');
            
            try {
                const pdfHTML = generatePDFHTML(sampleStats, period);
                
                // Try window.open method
                const printWindow = window.open('', '_blank', 'width=800,height=600');
                
                if (printWindow) {
                    log('‚úÖ Opening PDF in new window...', 'success');
                    printWindow.document.write(pdfHTML);
                    printWindow.document.close();
                    
                    setTimeout(() => {
                        printWindow.focus();
                        printWindow.print();
                        log('üìÑ Print dialog opened - Select "Save as PDF"', 'info');
                    }, 500);
                } else {
                    log('‚ùå Popup blocked - Using fallback method', 'warning');
                    
                    // Fallback: Create blob and download
                    const blob = new Blob([pdfHTML], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `laporan-${period.replace(' ', '-')}.html`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    log('üìÅ HTML file downloaded - Open and print to PDF', 'success');
                }
                
            } catch (error) {
                log('‚ùå Error: ' + error.message, 'error');
            }
        }

        // Show manual instructions
        function showInstructions() {
            const instructions = document.getElementById('instructions');
            instructions.style.display = instructions.style.display === 'none' ? 'block' : 'none';
            log('üìã Manual instructions toggled', 'info');
        }

        // Initial setup
        log('üöÄ PDF Export Fix Tool loaded successfully', 'success');
        log('üìä Sample data ready for testing', 'info');
        log('üîß Click buttons above to test PDF generation', 'info');
        log('', 'info');
        log('üí° QUICK SOLUTION for your app:', 'warning');
        log('1. Go to localhost:5000/reports', 'warning');
        log('2. Press Ctrl+P (or Cmd+P on Mac)', 'warning');
        log('3. Select "Save as PDF" as destination', 'warning');
        log('4. Click Save', 'warning');
    </script>
</body>
</html>