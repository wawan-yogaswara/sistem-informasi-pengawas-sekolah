<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÑ Laporan Kegiatan Pengawas Sekolah</title>
    <style>
        @page {
            size: A4;
            margin: 0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
            color: #333;
            background: white;
        }
        
        /* COVER PAGE STYLES */
        .cover-page {
            height: 100vh;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #60a5fa 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            page-break-after: always;
            position: relative;
            overflow: hidden;
        }
        
        .cover-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }
        
        .cover-logo {
            width: 120px;
            height: 120px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            margin-bottom: 30px;
            border: 3px solid rgba(255,255,255,0.3);
            position: relative;
            z-index: 2;
        }
        
        .cover-title {
            font-size: 42px;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
        }
        
        .cover-subtitle {
            font-size: 24px;
            margin-bottom: 40px;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }
        
        .cover-info {
            background: rgba(255,255,255,0.15);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            z-index: 2;
        }
        
        .cover-info h3 {
            font-size: 24px;
            margin-bottom: 10px;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .cover-info h4 {
            font-size: 20px;
            margin-bottom: 15px;
            color: white;
            font-weight: 600;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        
        .cover-info p {
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .cover-date {
            position: absolute;
            bottom: 40px;
            right: 40px;
            font-size: 14px;
            opacity: 0.8;
            z-index: 2;
        }
        
        /* CONTENT PAGES */
        .content-page {
            min-height: 100vh;
            padding: 40px;
            page-break-before: always;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #1e3a8a;
        }
        
        .page-header h1 {
            font-size: 24px;
            color: #1e3a8a;
            margin-bottom: 10px;
        }
        
        .page-header h2 {
            font-size: 18px;
            color: #666;
            font-weight: normal;
        }
        
        /* STATISTICS SECTION */
        .stats-section {
            margin: 30px 0;
        }
        
        .stats-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #1e3a8a;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid #1e3a8a;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #1e3a8a;
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 14px;
            text-transform: uppercase;
            font-weight: 600;
            color: #475569;
            letter-spacing: 1px;
        }
        
        /* PHOTO GALLERY SECTION */
        .photo-section {
            margin: 40px 0;
            page-break-inside: avoid;
        }
        
        .photo-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #1e3a8a;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }
        
        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .photo-item {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .photo-placeholder {
            width: 100%;
            height: 150px;
            background: linear-gradient(45deg, #e2e8f0 25%, transparent 25%), 
                        linear-gradient(-45deg, #e2e8f0 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #e2e8f0 75%), 
                        linear-gradient(-45deg, transparent 75%, #e2e8f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            font-size: 14px;
            text-align: center;
        }
        
        .photo-caption {
            padding: 10px;
            font-size: 12px;
            color: #475569;
            text-align: center;
            background: white;
        }
        
        /* SUMMARY SECTION */
        .summary-section {
            margin: 40px 0;
        }
        
        .summary-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #1e3a8a;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }
        
        .summary-list {
            list-style: none;
            padding: 0;
        }
        
        .summary-list li {
            margin-bottom: 15px;
            padding: 15px;
            background: #f8fafc;
            border-left: 4px solid #1e3a8a;
            border-radius: 0 8px 8px 0;
            position: relative;
        }
        
        .summary-list li:before {
            content: "‚úì";
            position: absolute;
            left: -12px;
            top: 50%;
            transform: translateY(-50%);
            background: #1e3a8a;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* SIGNATURE SECTION */
        .signature-section {
            margin-top: 60px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .signature-box {
            text-align: center;
            width: 250px;
        }
        
        .signature-date {
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .signature-title {
            margin-bottom: 80px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .signature-name {
            font-weight: bold;
            border-bottom: 2px solid #333;
            padding-bottom: 5px;
            font-size: 14px;
        }
        
        .signature-nip {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        /* FOOTER */
        .page-footer {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 10px;
            color: #666;
            font-style: italic;
        }
        
        /* PRINT STYLES */
        @media print {
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .no-print {
                display: none !important;
            }
            
            .page-break {
                page-break-before: always;
            }
        }
        
        /* SCREEN ONLY STYLES */
        .screen-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            background: #1e3a8a;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #1e40af;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: #059669;
        }
        
        .btn-success:hover {
            background: #047857;
        }
    </style>
</head>
<body>
    <!-- SCREEN CONTROLS -->
    <div class="screen-controls no-print">
        <button class="btn" onclick="generatePDF()">üìÑ Generate PDF</button>
        <button class="btn btn-success" onclick="window.print()">üñ®Ô∏è Print/Save</button>
        <button class="btn" onclick="refreshData()">üîÑ Refresh Data</button>
    </div>

    <!-- COVER PAGE -->
    <div class="cover-page">
        <div class="cover-logo">üè´</div>
        <h1 class="cover-title">LAPORAN KEGIATAN</h1>
        <h2 class="cover-subtitle">PENGAWAS SEKOLAH</h2>
        
        <div class="cover-info">
            <h3>Dinas Pendidikan Provinsi Jawa Barat</h3>
            <h4>Cabang Dinas Pendidikan Wilayah XI Garut</h4>
            <p id="cover-period">Periode: Desember 2025</p>
            <p id="cover-supervisor">Pengawas: H. Wawan Yogaswara, S.Pd, M.Pd</p>
            <p style="font-size: 14px; margin-top: 10px; opacity: 0.9;">Wilayah Kerja: Kabupaten Garut</p>
        </div>
        
        <div class="cover-date" id="cover-date">
            Garut, 20 Desember 2025
        </div>
    </div>

    <!-- CONTENT PAGE 1: STATISTICS -->
    <div class="content-page">
        <div class="page-header">
            <h1>Ringkasan Kegiatan Pengawasan Sekolah</h1>
            <h2 id="stats-period">Periode: Desember 2025 - Kabupaten Garut</h2>
        </div>

        <div class="stats-section">
            <div class="stats-title">üìä Statistik Pencapaian</div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="stat-total-tasks">3</div>
                    <div class="stat-label">Total Tugas Pokok</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-completed-tasks">2</div>
                    <div class="stat-label">Tugas Selesai</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-supervisions">3</div>
                    <div class="stat-label">Kegiatan Supervisi</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-additional-tasks">6</div>
                    <div class="stat-label">Tugas Tambahan</div>
                </div>
            </div>
        </div>

        <div class="summary-section">
            <div class="summary-title">üìã Ringkasan Pencapaian Kegiatan</div>
            <ul class="summary-list" id="achievement-list">
                <li>Telah menyelesaikan 3 tugas pokok sesuai dengan rencana kerja yang ditetapkan</li>
                <li>Tingkat penyelesaian tugas mencapai 67% dari target yang ditetapkan</li>
                <li>Melaksanakan 3 kegiatan supervisi ke sekolah-sekolah binaan</li>
                <li>Berpartisipasi aktif dalam 6 kegiatan pengembangan dan pelatihan</li>
                <li>Semua kegiatan dilaksanakan dengan mengacu pada standar operasional prosedur</li>
                <li>Dokumentasi dan pelaporan kegiatan telah dilakukan secara tertib dan tepat waktu</li>
            </ul>
        </div>
    </div>

    <!-- CONTENT PAGE 2: PHOTO GALLERY -->
    <div class="content-page">
        <div class="page-header">
            <h1>Dokumentasi Kegiatan Pengawasan</h1>
            <h2 id="photo-period">Periode: Desember 2025 - Kabupaten Garut</h2>
        </div>

        <div class="photo-section">
            <div class="photo-title">üì∏ Galeri Foto Kegiatan (Maksimal 6 Foto)</div>
            <div class="photo-gallery" id="photo-gallery">
                <!-- Photos will be loaded here -->
                <div class="photo-item">
                    <div class="photo-placeholder">
                        üì∑<br>Foto Kegiatan 1<br><small>Supervisi Sekolah</small>
                    </div>
                    <div class="photo-caption">Kegiatan supervisi akademik di SMKN 4 Garut</div>
                </div>
                <div class="photo-item">
                    <div class="photo-placeholder">
                        üì∑<br>Foto Kegiatan 2<br><small>Rapat Koordinasi</small>
                    </div>
                    <div class="photo-caption">Rapat koordinasi pengawas sekolah</div>
                </div>
                <div class="photo-item">
                    <div class="photo-placeholder">
                        üì∑<br>Foto Kegiatan 3<br><small>Workshop</small>
                    </div>
                    <div class="photo-caption">Workshop implementasi kurikulum merdeka</div>
                </div>
                <div class="photo-item">
                    <div class="photo-placeholder">
                        üì∑<br>Foto Kegiatan 4<br><small>Bimbingan Teknis</small>
                    </div>
                    <div class="photo-caption">Bimbingan teknis penyusunan RPS</div>
                </div>
                <div class="photo-item">
                    <div class="photo-placeholder">
                        üì∑<br>Foto Kegiatan 5<br><small>Evaluasi Program</small>
                    </div>
                    <div class="photo-caption">Evaluasi program sekolah penggerak</div>
                </div>
                <div class="photo-item">
                    <div class="photo-placeholder">
                        üì∑<br>Foto Kegiatan 6<br><small>Sosialisasi</small>
                    </div>
                    <div class="photo-caption">Sosialisasi asesmen nasional</div>
                </div>
            </div>
            
            <div style="background: #f8fafc; padding: 20px; border-radius: 8px; border-left: 4px solid #1e3a8a;">
                <p style="font-size: 14px; color: #475569; margin: 0;">
                    <strong>Catatan:</strong> Dokumentasi kegiatan di atas merupakan bukti pelaksanaan tugas pengawasan sekolah 
                    di wilayah Kabupaten Garut. Setiap kegiatan dilaksanakan sesuai dengan program kerja tahunan dan 
                    mengacu pada standar nasional pendidikan serta kebijakan Dinas Pendidikan Provinsi Jawa Barat.
                </p>
            </div>
        </div>

        <div class="signature-section">
            <div class="signature-box" style="margin: 0 auto;">
                <div class="signature-date" id="signature-date">Garut, 20 Desember 2025</div>
                <div class="signature-title">Pengawas Sekolah</div>
                <div class="signature-name" id="signature-name">H. Wawan Yogaswara, S.Pd, M.Pd</div>
                <div class="signature-nip" id="signature-nip">NIP. 196805301994121001</div>
            </div>
        </div>
    </div>

    <!-- PAGE FOOTER -->
    <div class="page-footer no-print">
        Laporan ini dibuat secara otomatis melalui Sistem Informasi Pengawas Sekolah - Dinas Pendidikan Provinsi Jawa Barat
    </div>

    <script>
        // Get current date
        const currentDate = new Date();
        const currentYear = currentDate.getFullYear();
        const currentMonth = String(currentDate.getMonth() + 1).padStart(2, '0');
        
        // Indonesian month names
        const monthNames = [
            'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
            'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
        ];
        
        // Format current period
        const currentPeriod = `${monthNames[currentDate.getMonth()]} ${currentYear}`;
        const currentDateFormatted = currentDate.toLocaleDateString('id-ID', { 
            day: 'numeric', 
            month: 'long', 
            year: 'numeric' 
        });
        
        // Load data from localStorage or use defaults
        async function loadReportData() {
            try {
                console.log('üîÑ Loading report data...');
                
                // Get REAL data from multiple sources
                const tasks = JSON.parse(localStorage.getItem('tasks_data') || '[]');
                const supervisions = JSON.parse(localStorage.getItem('supervisions_data') || '[]');
                const additionalTasks = JSON.parse(localStorage.getItem('additional_tasks_data') || '[]');
                const schools = JSON.parse(localStorage.getItem('schools_data') || '[]');
                
                // Calculate REAL statistics
                const totalTasks = tasks.length;
                const completedTasks = tasks.filter(task => task.status === 'completed' || task.completed).length;
                const totalSupervisions = supervisions.length;
                const totalAdditionalTasks = additionalTasks.length;
                const totalSchools = schools.length;
                
                console.log('üìä REAL Statistics:');
                console.log('- Total Tasks:', totalTasks);
                console.log('- Completed Tasks:', completedTasks);
                console.log('- Supervisions:', totalSupervisions);
                console.log('- Additional Tasks:', totalAdditionalTasks);
                console.log('- Schools:', totalSchools);
                
                // Update statistics with REAL data
                document.getElementById('stat-total-tasks').textContent = totalTasks || 0;
                document.getElementById('stat-completed-tasks').textContent = completedTasks || 0;
                document.getElementById('stat-supervisions').textContent = totalSupervisions || 0;
                document.getElementById('stat-additional-tasks').textContent = totalAdditionalTasks || 0;
                
                // Update periods
                document.getElementById('cover-period').textContent = `Periode: ${currentPeriod}`;
                document.getElementById('stats-period').textContent = `Periode: ${currentPeriod}`;
                document.getElementById('photo-period').textContent = `Periode: ${currentPeriod}`;
                
                // Get REAL supervisor info from profile
                let supervisorName = 'H. Wawan Yogaswara, S.Pd, M.Pd';
                let supervisorNIP = '196805301994121001';
                let supervisorPosition = 'Pengawas Sekolah';
                
                // Try to get from API first
                try {
                    const response = await fetch('/api/auth/me');
                    if (response.ok) {
                        const userData = await response.json();
                        if (userData.user) {
                            supervisorName = userData.user.name || userData.user.fullName || supervisorName;
                            supervisorNIP = userData.user.nip || userData.user.employeeId || supervisorNIP;
                            supervisorPosition = userData.user.position || supervisorPosition;
                        }
                    }
                } catch (apiError) {
                    console.log('API not available, using localStorage');
                }
                
                // Fallback to localStorage with CORRECT NIP priority
                const userProfile = JSON.parse(localStorage.getItem('user_profile') || '{}');
                const currentUser = JSON.parse(localStorage.getItem('current_user') || '{}');
                const userData = JSON.parse(localStorage.getItem('user_data') || '{}');
                
                // Priority: user_data > current_user > user_profile
                if (userData.fullName && !userData.fullName.includes('Administrator')) {
                    supervisorName = userData.fullName;
                    supervisorNIP = userData.nip || supervisorNIP;
                    supervisorPosition = userData.position || supervisorPosition;
                } else if (currentUser.name && !currentUser.name.includes('Administrator')) {
                    supervisorName = currentUser.name;
                    supervisorNIP = currentUser.nip || supervisorNIP;
                    supervisorPosition = currentUser.position || supervisorPosition;
                } else if (userProfile.name && !userProfile.name.includes('Administrator')) {
                    supervisorName = userProfile.name;
                    supervisorNIP = userProfile.nip || supervisorNIP;
                    supervisorPosition = userProfile.position || supervisorPosition;
                }
                
                console.log('‚úÖ Final Supervisor Data:');
                console.log('- Name:', supervisorName);
                console.log('- NIP:', supervisorNIP);
                console.log('- Position:', supervisorPosition);
                
                // Update display
                document.getElementById('cover-supervisor').textContent = `Pengawas: ${supervisorName}`;
                document.getElementById('signature-name').textContent = supervisorName;
                document.getElementById('signature-nip').textContent = `NIP. ${supervisorNIP}`;
                
                // Update dates
                document.getElementById('cover-date').textContent = `Garut, ${currentDateFormatted}`;
                document.getElementById('signature-date').textContent = `Garut, ${currentDateFormatted}`;
                
                // Update achievement list with REAL data
                updateAchievementList({
                    totalTasks,
                    completedTasks,
                    supervisions: totalSupervisions,
                    schools: totalSchools
                }, totalAdditionalTasks);
                
                // Load REAL photos
                loadRealPhotos();
                
            } catch (error) {
                console.log('Error loading data:', error);
                loadDefaultData();
            }
        }
        
        function updateAchievementList(stats, additionalTasksCount) {
            const totalTasks = stats.totalTasks || 0;
            const completedTasks = stats.completedTasks || 0;
            const supervisions = stats.supervisions || 0;
            const schools = stats.schools || 0;
            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            // Get REAL activities from database
            const tasks = JSON.parse(localStorage.getItem('tasks_data') || '[]');
            const supervisionsData = JSON.parse(localStorage.getItem('supervisions_data') || '[]');
            const additionalTasksData = JSON.parse(localStorage.getItem('additional_tasks_data') || '[]');
            const userActivities = JSON.parse(localStorage.getItem('user_activities') || '[]');
            
            let realAchievements = [];
            
            // Add real task achievements
            tasks.forEach(task => {
                if (task.title || task.description) {
                    const status = task.status === 'completed' || task.completed ? 'selesai' : 'dalam proses';
                    realAchievements.push(`Melaksanakan tugas "${task.title || task.description}" - ${status}`);
                }
            });
            
            // Add real supervision achievements
            supervisionsData.forEach(supervision => {
                if (supervision.school || supervision.schoolName) {
                    realAchievements.push(`Supervisi akademik di ${supervision.school || supervision.schoolName}`);
                }
            });
            
            // Add real additional task achievements
            additionalTasksData.forEach(task => {
                if (task.title || task.description) {
                    realAchievements.push(`Tugas tambahan: ${task.title || task.description}`);
                }
            });
            
            // Add real user activities
            userActivities.forEach(activity => {
                if (activity.description || activity.title) {
                    realAchievements.push(`Aktivitas: ${activity.description || activity.title}`);
                }
            });
            
            // If we have real achievements, use them (max 7), otherwise use default
            let achievements;
            if (realAchievements.length > 0) {
                achievements = realAchievements.slice(0, 7);
            } else {
                achievements = [
                    `Melaksanakan ${supervisions} kegiatan supervisi ke sekolah-sekolah binaan di Kabupaten Garut`,
                    `Menyelesaikan ${completedTasks} dari ${totalTasks} tugas pokok dengan tingkat pencapaian ${completionRate}%`,
                    `Membina ${schools} sekolah dalam wilayah kerja Cabang Dinas Pendidikan Wilayah XI`,
                    `Berpartisipasi aktif dalam ${additionalTasksCount} kegiatan pengembangan profesional dan pelatihan`,
                    `Melakukan monitoring dan evaluasi implementasi kurikulum merdeka di sekolah binaan`,
                    `Memberikan bimbingan teknis kepada kepala sekolah dan guru dalam peningkatan mutu pendidikan`,
                    `Menyusun laporan hasil supervisi dan rekomendasi perbaikan secara berkala dan tepat waktu`
                ];
            }
            
            const listElement = document.getElementById('achievement-list');
            listElement.innerHTML = achievements.map(achievement => `<li>${achievement}</li>`).join('');
        }
        
        function loadRealPhotos() {
            try {
                console.log('üì∏ Loading REAL photos from database...');
                
                const photoGallery = document.getElementById('photo-gallery');
                if (!photoGallery) return;
                
                // Clear gallery
                photoGallery.innerHTML = '';
                
                let realPhotos = [];
                
                // AGGRESSIVE SEARCH for photos from ALL sources
                const allSources = [
                    'user_data', 'user_profile', 'current_user', 'profile_data',
                    'supervisions_data', 'tasks_data', 'user_activities', 
                    'additional_tasks_data', 'uploaded_photos'
                ];
                
                allSources.forEach(source => {
                    try {
                        const data = localStorage.getItem(source);
                        if (data) {
                            const parsed = JSON.parse(data);
                            
                            if (Array.isArray(parsed)) {
                                parsed.forEach(item => {
                                    if (item && typeof item === 'object') {
                                        // Check all possible photo fields
                                        ['photo', 'image', 'photoUrl', 'profilePhoto', 'avatar', 'picture'].forEach(field => {
                                            if (item[field] && typeof item[field] === 'string' && item[field].trim()) {
                                                realPhotos.push(item[field].trim());
                                            }
                                        });
                                    }
                                });
                            } else if (parsed && typeof parsed === 'object') {
                                // Check single object
                                ['photo', 'image', 'photoUrl', 'profilePhoto', 'avatar', 'picture'].forEach(field => {
                                    if (parsed[field] && typeof parsed[field] === 'string' && parsed[field].trim()) {
                                        realPhotos.push(parsed[field].trim());
                                    }
                                });
                            }
                        }
                    } catch (e) {
                        console.log(`Error parsing ${source}:`, e);
                    }
                });
                
                // Remove duplicates
                realPhotos = [...new Set(realPhotos)];
                
                console.log('üì∏ Found real photos:', realPhotos.length, realPhotos);
                
                // Display photos (max 6)
                const photosToShow = realPhotos.slice(0, 6);
                
                photosToShow.forEach((photoUrl, index) => {
                    const photoItem = document.createElement('div');
                    photoItem.className = 'photo-item';
                    
                    const img = document.createElement('img');
                    img.src = photoUrl;
                    img.alt = `Foto Kegiatan ${index + 1}`;
                    img.style.cssText = 'width: 100%; height: 150px; object-fit: cover; border-radius: 4px;';
                    
                    img.onload = () => console.log(`‚úÖ Photo ${index + 1} loaded: ${photoUrl}`);
                    img.onerror = () => {
                        console.log(`‚ùå Photo ${index + 1} failed: ${photoUrl}`);
                        // Try to fix relative URLs
                        if (!photoUrl.startsWith('http') && !photoUrl.startsWith('data:')) {
                            img.src = window.location.origin + photoUrl;
                        } else {
                            img.src = `https://via.placeholder.com/300x200/1e3a8a/ffffff?text=Foto+${index + 1}`;
                        }
                    };
                    
                    photoItem.appendChild(img);
                    photoGallery.appendChild(photoItem);
                });
                
                // Fill remaining with professional placeholders
                const placeholderCaptions = [
                    'Supervisi Akademik di Sekolah Binaan',
                    'Rapat Koordinasi Pengawas Wilayah XI', 
                    'Workshop Implementasi Kurikulum Merdeka',
                    'Bimbingan Teknis Penyusunan Perangkat',
                    'Evaluasi Program Sekolah Penggerak',
                    'Sosialisasi Kebijakan Pendidikan'
                ];
                
                for (let i = photosToShow.length; i < 6; i++) {
                    const photoItem = document.createElement('div');
                    photoItem.className = 'photo-item';
                    
                    const img = document.createElement('img');
                    img.src = `https://via.placeholder.com/300x200/1e3a8a/ffffff?text=Kegiatan+${i + 1}`;
                    img.alt = placeholderCaptions[i];
                    img.style.cssText = 'width: 100%; height: 150px; object-fit: cover; border-radius: 4px;';
                    
                    photoItem.appendChild(img);
                    photoGallery.appendChild(photoItem);
                }
                
                console.log(`üì∏ FINAL: ${photosToShow.length} real photos + ${6 - photosToShow.length} placeholders`);
                
            } catch (error) {
                console.log('Error loading real photos:', error);
                loadProfessionalPlaceholders();
            }
        }
        
        function loadProfessionalPlaceholders() {
            console.log('üì∏ Loading professional placeholder photos...');
            
            const photoGallery = document.getElementById('photo-gallery');
            photoGallery.innerHTML = '';
            
            const professionalPhotos = [
                {
                    url: 'https://via.placeholder.com/300x200/1e3a8a/ffffff?text=Supervisi+Akademik',
                    caption: 'Supervisi Akademik di SMAN 1 Garut'
                },
                {
                    url: 'https://via.placeholder.com/300x200/059669/ffffff?text=Rapat+Koordinasi',
                    caption: 'Rapat Koordinasi Pengawas Wilayah XI Garut'
                },
                {
                    url: 'https://via.placeholder.com/300x200/dc2626/ffffff?text=Workshop+Guru',
                    caption: 'Workshop Implementasi Kurikulum Merdeka'
                },
                {
                    url: 'https://via.placeholder.com/300x200/7c3aed/ffffff?text=Bimbingan+Teknis',
                    caption: 'Bimbingan Teknis Penyusunan Perangkat Pembelajaran'
                },
                {
                    url: 'https://via.placeholder.com/300x200/ea580c/ffffff?text=Evaluasi+Program',
                    caption: 'Evaluasi Program Sekolah Penggerak'
                },
                {
                    url: 'https://via.placeholder.com/300x200/0891b2/ffffff?text=Sosialisasi',
                    caption: 'Sosialisasi Kebijakan Pendidikan Terbaru'
                }
            ];
            
            professionalPhotos.forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                
                photoItem.innerHTML = `
                    <img src="${photo.url}" alt="${photo.caption}" 
                         style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px;">
                    <div class="photo-caption">${photo.caption}</div>
                `;
                
                photoGallery.appendChild(photoItem);
            });
            
            console.log('üì∏ Professional placeholders loaded');
        }
                            caption: 'Rapat Koordinasi Pengawas Wilayah XI'
                        },
                        {
                            url: 'https://via.placeholder.com/300x200/dc2626/ffffff?text=Workshop+Guru',
                            caption: 'Workshop Peningkatan Kompetensi Guru'
                        },
                        {
                            url: 'https://via.placeholder.com/300x200/7c3aed/ffffff?text=Bimbingan+Teknis',
                            caption: 'Bimbingan Teknis Kurikulum Merdeka'
                        },
                        {
                            url: 'https://via.placeholder.com/300x200/ea580c/ffffff?text=Evaluasi+Program',
                            caption: 'Evaluasi Program Sekolah Penggerak'
                        },
                        {
                            url: 'https://via.placeholder.com/300x200/0891b2/ffffff?text=Sosialisasi',
                            caption: 'Sosialisasi Kebijakan Pendidikan Terbaru'
                        }
                    ];
                } else {
                    // Limit to 6 photos
                    photos = photos.slice(0, 6);
                }
                
                // Load photos with smooth transition
                photos.forEach((photo, index) => {
                    const photoItem = document.createElement('div');
                    photoItem.className = 'photo-item';
                    
                    photoItem.innerHTML = `
                        <img src="${photo.url}" alt="${photo.caption}" 
                             style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px; opacity: 0; transition: opacity 0.3s;"
                             onload="this.style.opacity = 1; console.log('‚úÖ Photo ${index + 1} loaded');"
                             onerror="this.src='https://via.placeholder.com/300x200/64748b/ffffff?text=Foto+${index + 1}'; this.style.opacity = 1;">
                        <div class="photo-caption">${photo.caption}</div>
                    `;
                    
                    photoGallery.appendChild(photoItem);
                });
                
                // Fill remaining slots if less than 6
                const samplePhotos = [
                    { url: 'https://via.placeholder.com/300x200/1e3a8a/ffffff?text=Supervisi+Sekolah', caption: 'Supervisi Pembelajaran di SMAN 1 Garut' },
                    { url: 'https://via.placeholder.com/300x200/059669/ffffff?text=Rapat+Koordinasi', caption: 'Rapat Koordinasi Pengawas Wilayah XI' },
                    { url: 'https://via.placeholder.com/300x200/dc2626/ffffff?text=Workshop+Guru', caption: 'Workshop Peningkatan Kompetensi Guru' },
                    { url: 'https://via.placeholder.com/300x200/7c3aed/ffffff?text=Bimbingan+Teknis', caption: 'Bimbingan Teknis Kurikulum Merdeka' },
                    { url: 'https://via.placeholder.com/300x200/ea580c/ffffff?text=Evaluasi+Program', caption: 'Evaluasi Program Sekolah Penggerak' },
                    { url: 'https://via.placeholder.com/300x200/0891b2/ffffff?text=Sosialisasi', caption: 'Sosialisasi Kebijakan Pendidikan Terbaru' }
                ];
                
                for (let i = photos.length; i < 6; i++) {
                    const photoItem = document.createElement('div');
                    photoItem.className = 'photo-item';
                    const samplePhoto = samplePhotos[i % samplePhotos.length];
                    
                    photoItem.innerHTML = `
                        <img src="${samplePhoto.url}" alt="${samplePhoto.caption}" 
                             style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px; opacity: 0; transition: opacity 0.3s;"
                             onload="this.style.opacity = 1;">
                        <div class="photo-caption">${samplePhoto.caption}</div>
                    `;
                    
                    photoGallery.appendChild(photoItem);
                }
                
                photosLoaded = true; // Mark as loaded to prevent flickering
                console.log(`üì∏ Loaded ${photos.length} photos successfully (no flickering)`);
                
            } catch (error) {
                console.log('Error loading photos:', error);
                // Fallback to placeholder photos
                loadPlaceholderPhotos();
            }
        }
        
        function loadPlaceholderPhotos() {
            const photoGallery = document.getElementById('photo-gallery');
            photoGallery.innerHTML = '';
            
            const activities = [
                'Supervisi Sekolah',
                'Rapat Koordinasi', 
                'Workshop',
                'Bimbingan Teknis',
                'Evaluasi Program',
                'Sosialisasi'
            ];
            
            for (let i = 0; i < 6; i++) {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                
                photoItem.innerHTML = `
                    <div class="photo-placeholder">
                        üì∑<br>Foto Kegiatan ${i + 1}<br><small>${activities[i]}</small>
                    </div>
                    <div class="photo-caption">Kegiatan ${activities[i].toLowerCase()}</div>
                `;
                
                photoGallery.appendChild(photoItem);
            }
        }
        
        function generatePDF() {
            console.log('üìÑ Generating PDF with REAL data...');
            
            // Reload all data
            loadReportData();
            
            // Show info
            const tasks = JSON.parse(localStorage.getItem('tasks_data') || '[]');
            const supervisions = JSON.parse(localStorage.getItem('supervisions_data') || '[]');
            const additionalTasks = JSON.parse(localStorage.getItem('additional_tasks_data') || '[]');
            const userProfile = JSON.parse(localStorage.getItem('user_profile') || '{}');
            const currentUser = JSON.parse(localStorage.getItem('current_user') || '{}');
            
            const supervisorName = currentUser.name || userProfile.name || 'H. Wawan Yogaswara, S.Pd, M.Pd';
            const supervisorNIP = currentUser.nip || userProfile.nip || '196512121990031004';
            
            alert(`üìÑ Laporan berhasil di-generate!\n\n` +
                  `üë§ Pengawas: ${supervisorName}\n` +
                  `üÜî NIP: ${supervisorNIP}\n\n` +
                  `üìä Statistik:\n` +
                  `- Tugas Pokok: ${tasks.length}\n` +
                  `- Supervisi: ${supervisions.length}\n` +
                  `- Tugas Tambahan: ${additionalTasks.length}\n\n` +
                  `Klik "Print/Save" untuk menyimpan sebagai PDF.`);
        }
        
        function refreshData() {
            console.log('üîÑ Refreshing all data...');
            loadReportData();
            alert('üîÑ Data berhasil di-refresh dengan data terbaru dari aplikasi!');
        }
        
        function loadDefaultData() {
            console.log('üìã Loading default data...');
            
            // Set default statistics
            document.getElementById('stat-total-tasks').textContent = '0';
            document.getElementById('stat-completed-tasks').textContent = '0';
            document.getElementById('stat-supervisions').textContent = '0';
            document.getElementById('stat-additional-tasks').textContent = '0';
            
            // Set default supervisor
            document.getElementById('cover-supervisor').textContent = 'Pengawas: H. Wawan Yogaswara, S.Pd, M.Pd';
            document.getElementById('signature-name').textContent = 'H. Wawan Yogaswara, S.Pd, M.Pd';
            document.getElementById('signature-nip').textContent = 'NIP. 196512121990031004';
            
            // Load professional placeholders
            loadProfessionalPlaceholders();
        }
        
        // Auto-load data when page loads
        window.onload = function() {
            console.log('üìÑ PDF Export Enhanced - Loading REAL data...');
            loadReportData();
        };
    </script>
</body>
</html>