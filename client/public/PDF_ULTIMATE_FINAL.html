<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÑ Laporan Kegiatan Pengawas Sekolah</title>
    <style>
        @page { size: A4; margin: 0; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Times New Roman', serif; line-height: 1.6; color: #333; background: white; }
        
        .cover-page {
            height: 100vh; background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #60a5fa 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
            color: white; page-break-after: always; position: relative; overflow: hidden;
        }
        .cover-logo { width: 120px; height: 120px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 48px; margin-bottom: 30px; border: 3px solid rgba(255,255,255,0.3); }
        .cover-title { font-size: 42px; font-weight: bold; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .cover-subtitle { font-size: 24px; margin-bottom: 40px; opacity: 0.9; }
        .cover-info { background: rgba(255,255,255,0.15); padding: 30px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .cover-info h3 { font-size: 24px; margin-bottom: 10px; color: white; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .cover-info h4 { font-size: 20px; margin-bottom: 15px; color: white; font-weight: 600; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        .cover-info p { font-size: 16px; margin-bottom: 10px; }
        .cover-date { position: absolute; bottom: 40px; right: 40px; font-size: 14px; opacity: 0.8; }
        
        .content-page { min-height: 100vh; padding: 40px; page-break-before: always; }
        .page-header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 3px solid #1e3a8a; }
        .page-header h1 { font-size: 24px; color: #1e3a8a; margin-bottom: 10px; }
        .page-header h2 { font-size: 18px; color: #666; font-weight: normal; }
        
        .stats-section { margin: 30px 0; }
        .stats-title { font-size: 18px; font-weight: bold; margin-bottom: 20px; color: #1e3a8a; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border: 2px solid #1e3a8a; border-radius: 10px; padding: 25px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .stat-number { font-size: 36px; font-weight: bold; color: #1e3a8a; margin-bottom: 10px; }
        .stat-label { font-size: 14px; text-transform: uppercase; font-weight: 600; color: #475569; letter-spacing: 1px; }
        
        .summary-section { margin: 40px 0; }
        .summary-title { font-size: 18px; font-weight: bold; margin-bottom: 20px; color: #1e3a8a; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; }
        .summary-list { list-style: none; padding: 0; }
        .summary-list li { margin-bottom: 15px; padding: 15px; background: #f8fafc; border-left: 4px solid #1e3a8a; border-radius: 0 8px 8px 0; position: relative; }
        .summary-list li:before { content: "‚úì"; position: absolute; left: -12px; top: 50%; transform: translateY(-50%); background: #1e3a8a; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; }
        
        .photo-section { margin: 40px 0; page-break-inside: avoid; }
        .photo-title { font-size: 18px; font-weight: bold; margin-bottom: 20px; color: #1e3a8a; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; }
        .photo-gallery { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        .photo-item { background: #f8fafc; border: 2px solid #e5e7eb; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); height: 150px; }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; display: block; }
        
        .signature-section { margin-top: 60px; display: flex; justify-content: space-between; align-items: flex-start; }
        .signature-box { text-align: center; width: 250px; }
        .signature-date { margin-bottom: 15px; font-size: 14px; }
        .signature-title { margin-bottom: 80px; font-size: 14px; font-weight: 600; }
        .signature-name { font-weight: bold; border-bottom: 2px solid #333; padding-bottom: 5px; font-size: 14px; }
        .signature-nip { font-size: 12px; color: #666; margin-top: 5px; }
        
        .screen-controls { position: fixed; top: 20px; right: 20px; z-index: 1000; background: rgba(255,255,255,0.95); padding: 15px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); backdrop-filter: blur(10px); }
        .btn { display: inline-block; padding: 10px 20px; margin: 5px; background: #1e3a8a; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 14px; border: none; cursor: pointer; transition: all 0.2s; }
        .btn:hover { background: #1e40af; transform: translateY(-1px); }
        .btn-success { background: #059669; }
        .btn-success:hover { background: #047857; }
        
        @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } .no-print { display: none !important; } }
    </style>
</head>
<body>
    <div class="screen-controls no-print">
        <button class="btn" onclick="loadFinalData()">üìÑ Load Data</button>
        <button class="btn btn-success" onclick="window.print()">üñ®Ô∏è Print/Save</button>
    </div>

    <div class="cover-page">
        <div class="cover-logo">üè´</div>
        <h1 class="cover-title">LAPORAN KEGIATAN</h1>
        <h2 class="cover-subtitle">PENGAWAS SEKOLAH</h2>
        <div class="cover-info">
            <h3>Dinas Pendidikan Provinsi Jawa Barat</h3>
            <h4>Cabang Dinas Pendidikan Wilayah XI Garut</h4>
            <p>Periode: Desember 2025</p>
            <p>Pengawas: H. Wawan Yogaswara, S.Pd, M.Pd</p>
            <p style="font-size: 14px; margin-top: 10px; opacity: 0.9;">Wilayah Kerja: Kabupaten Garut</p>
        </div>
        <div class="cover-date">Garut, 20 Desember 2025</div>
    </div>

    <div class="content-page">
        <div class="page-header">
            <h1>Ringkasan Kegiatan Pengawasan Sekolah</h1>
            <h2>Periode: Desember 2025 - Kabupaten Garut</h2>
        </div>
        <div class="stats-section">
            <div class="stats-title">üìä Statistik Pencapaian</div>
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-number" id="stat-total-tasks">0</div><div class="stat-label">Total Tugas Pokok</div></div>
                <div class="stat-card"><div class="stat-number" id="stat-completed-tasks">0</div><div class="stat-label">Tugas Selesai</div></div>
                <div class="stat-card"><div class="stat-number" id="stat-supervisions">0</div><div class="stat-label">Kegiatan Supervisi</div></div>
                <div class="stat-card"><div class="stat-number" id="stat-additional-tasks">0</div><div class="stat-label">Tugas Tambahan</div></div>
            </div>
        </div>
        <div class="summary-section">
            <div class="summary-title">üìã Ringkasan Kegiatan dari Database</div>
            <ul class="summary-list" id="activity-summary"></ul>
        </div>
    </div>

    <div class="content-page">
        <div class="page-header">
            <h1>Dokumentasi Kegiatan Pengawasan</h1>
            <h2>Periode: Desember 2025 - Kabupaten Garut</h2>
        </div>
        <div class="photo-section">
            <div class="photo-title">üì∏ Galeri Foto Kegiatan</div>
            <div class="photo-gallery" id="photo-gallery"></div>
        </div>
        <div class="signature-section">
            <div class="signature-box" style="margin: 0 auto;">
                <div class="signature-date">Garut, 20 Desember 2025</div>
                <div class="signature-title">Pengawas Sekolah</div>
                <div class="signature-name">H. Wawan Yogaswara, S.Pd, M.Pd</div>
                <div class="signature-nip">NIP. 196805301994121001</div>
            </div>
        </div>
    </div>

    <script>
        function loadFinalData() {
            console.log('üìÑ ULTIMATE FINAL - Loading ALL data...');
            
            // 1. Load statistics
            const tasks = JSON.parse(localStorage.getItem('tasks_data') || '[]');
            const supervisions = JSON.parse(localStorage.getItem('supervisions_data') || '[]');
            const additionalTasks = JSON.parse(localStorage.getItem('additional_tasks_data') || '[]');
            
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.status === 'completed' || t.completed || t.status === 'selesai').length;
            const totalSupervisions = supervisions.length;
            const totalAdditionalTasks = additionalTasks.length;
            
            document.getElementById('stat-total-tasks').textContent = totalTasks;
            document.getElementById('stat-completed-tasks').textContent = completedTasks;
            document.getElementById('stat-supervisions').textContent = totalSupervisions;
            document.getElementById('stat-additional-tasks').textContent = totalAdditionalTasks;
            
            // 2. Load activity summary
            const summaryList = document.getElementById('activity-summary');
            summaryList.innerHTML = '';
            
            let allActivities = [];
            
            // Process all activities
            tasks.forEach(task => {
                if (task.title || task.description) {
                    allActivities.push(`[Tugas Pokok] ${task.title || task.description} - ${task.status === 'completed' || task.completed ? 'Selesai' : 'Dalam Proses'}`);
                }
            });
            
            supervisions.forEach(supervision => {
                if (supervision.school || supervision.schoolName) {
                    allActivities.push(`[Supervisi] Supervisi di ${supervision.school || supervision.schoolName} - Selesai`);
                }
            });
            
            additionalTasks.forEach(task => {
                if (task.title || task.description) {
                    allActivities.push(`[Tugas Tambahan] ${task.title || task.description} - ${task.status || 'Selesai'}`);
                }
            });
            
            const userActivities = JSON.parse(localStorage.getItem('user_activities') || '[]');
            userActivities.forEach(activity => {
                if (activity.description || activity.title) {
                    allActivities.push(`[Aktivitas] ${activity.description || activity.title} - Selesai`);
                }
            });
            
            // Display activities
            if (allActivities.length > 0) {
                allActivities.slice(0, 10).forEach(activity => {
                    const li = document.createElement('li');
                    li.textContent = activity;
                    summaryList.appendChild(li);
                });
            } else {
                const defaultActivities = [
                    'Melaksanakan supervisi akademik di sekolah-sekolah binaan',
                    'Mengikuti rapat koordinasi pengawas sekolah tingkat kabupaten',
                    'Memberikan bimbingan teknis kepada kepala sekolah dan guru',
                    'Melakukan monitoring implementasi kurikulum merdeka',
                    'Berpartisipasi dalam workshop peningkatan kompetensi pengawas',
                    'Menyusun laporan hasil supervisi dan evaluasi program sekolah'
                ];
                defaultActivities.forEach(activity => {
                    const li = document.createElement('li');
                    li.textContent = activity;
                    summaryList.appendChild(li);
                });
            }
            
            // 3. Load photos AGGRESSIVELY
            const gallery = document.getElementById('photo-gallery');
            gallery.innerHTML = '';
            
            let foundPhotos = [];
            
            // AGGRESSIVE PHOTO SEARCH
            const allData = [
                localStorage.getItem('user_profile'),
                localStorage.getItem('user_data'),
                localStorage.getItem('current_user'),
                JSON.stringify(tasks),
                JSON.stringify(supervisions),
                JSON.stringify(additionalTasks),
                JSON.stringify(userActivities),
                localStorage.getItem('uploaded_photos')
            ];
            
            allData.forEach(dataStr => {
                if (dataStr) {
                    try {
                        const matches = dataStr.match(/"(photo|image|photoUrl|profilePhoto|avatar)":\s*"([^"]+)"/g);
                        if (matches) {
                            matches.forEach(match => {
                                const url = match.split('"')[3];
                                if (url && !foundPhotos.includes(url)) {
                                    foundPhotos.push(url);
                                }
                            });
                        }
                    } catch (e) {}
                }
            });
            
            console.log('üì∏ FOUND PHOTOS:', foundPhotos);
            
            // Display photos
            const photosToShow = foundPhotos.slice(0, 6);
            photosToShow.forEach((photoUrl, index) => {
                const photoDiv = document.createElement('div');
                photoDiv.className = 'photo-item';
                const img = document.createElement('img');
                img.src = photoUrl;
                img.alt = `Foto ${index + 1}`;
                img.onload = () => console.log(`‚úÖ Photo ${index + 1} loaded`);
                img.onerror = () => {
                    console.log(`‚ùå Photo ${index + 1} failed`);
                    if (!photoUrl.startsWith('http')) {
                        img.src = window.location.origin + photoUrl;
                    } else {
                        photoDiv.style.display = 'none';
                    }
                };
                photoDiv.appendChild(img);
                gallery.appendChild(photoDiv);
            });
            
            // Fill remaining with placeholders
            for (let i = photosToShow.length; i < 6; i++) {
                const photoDiv = document.createElement('div');
                photoDiv.className = 'photo-item';
                const img = document.createElement('img');
                img.src = `https://via.placeholder.com/300x200/1e3a8a/ffffff?text=Kegiatan+${i + 1}`;
                img.alt = `Kegiatan ${i + 1}`;
                photoDiv.appendChild(img);
                gallery.appendChild(photoDiv);
            }
            
            alert(`‚úÖ ULTIMATE FINAL LOADED!\n\n` +
                  `üìä Tugas: ${totalTasks} (${completedTasks} selesai)\n` +
                  `üìä Supervisi: ${totalSupervisions}\n` +
                  `üìä Tugas Tambahan: ${totalAdditionalTasks}\n` +
                  `üìã Aktivitas: ${allActivities.length} kegiatan\n` +
                  `üì∏ Foto: ${foundPhotos.length} dari database\n\n` +
                  `üë§ H. Wawan Yogaswara, S.Pd, M.Pd\n` +
                  `üÜî NIP: 196805301994121001`);
        }
        
        // Auto load on page load
        window.onload = loadFinalData;
    </script>
</body>
</html>