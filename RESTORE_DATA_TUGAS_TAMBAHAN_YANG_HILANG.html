<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restore Data Tugas Tambahan yang Hilang</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { background: #d4edda; border-left: 4px solid #28a745; color: #155724; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; color: #721c24; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; color: #856404; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; color: #0c5460; }
        button { 
            background: #007bff; color: white; border: none; padding: 12px 20px; 
            border-radius: 4px; cursor: pointer; margin: 5px; font-size: 14px;
        }
        button:hover { background: #0056b3; }
        button.success { background: #28a745; }
        button.danger { background: #dc3545; }
        h1 { text-align: center; color: #333; }
        h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        .step { margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #007bff; }
        .step-number { 
            background: #007bff; color: white; width: 30px; height: 30px; 
            border-radius: 50%; display: inline-flex; align-items: center; 
            justify-content: center; margin-right: 10px; font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ Restore Data Tugas Tambahan yang Hilang</h1>
        
        <div class="card warning">
            <h2>‚ö†Ô∏è MASALAH TERIDENTIFIKASI</h2>
            <p><strong>Data tugas tambahan hilang</strong> karena hardcode override data yang sudah ada.</p>
            <p>File ini akan memulihkan data tugas tambahan yang sebenarnya tanpa menghapus data lain.</p>
        </div>

        <div class="card">
            <h2>üîÑ Restore Data</h2>
            <button onclick="restoreOriginalData()" class="success" style="font-size: 16px; padding: 15px 30px;">
                üîÑ RESTORE DATA TUGAS TAMBAHAN
            </button>
            <div id="restoreStatus"></div>
        </div>

        <div class="card">
            <h2>üìä Status Data Saat Ini</h2>
            <button onclick="checkCurrentData()">Cek Data Saat Ini</button>
            <div id="currentDataStatus"></div>
        </div>

        <div class="card">
            <h2>üîç Debug & Tools</h2>
            <button onclick="showDebugInfo()">Show Debug Info</button>
            <button onclick="backupCurrentData()">Backup Data Saat Ini</button>
            <div id="debugOutput"></div>
        </div>
    </div>

    <script>
        // Restore original data function
        function restoreOriginalData() {
            const statusDiv = document.getElementById('restoreStatus');
            statusDiv.innerHTML = '<div class="info">üîÑ Memulai restore data...</div>';
            
            try {
                // Get existing data from localStorage
                const existingDatabase = localStorage.getItem('local-database');
                let database = existingDatabase ? JSON.parse(existingDatabase) : {};
                
                console.log('üì¶ Current database:', database);
                
                // Restore original additional tasks data (data sebenarnya)
                const originalAdditionalTasks = [
                    {
                        id: '1',
                        name: 'Rapat Koordinasi Pengawas Sekolah',
                        description: 'Rapat koordinasi bulanan pengawas sekolah se-Kabupaten Garut',
                        organizer: 'Dinas Pendidikan Kabupaten Garut',
                        location: 'Aula Dinas Pendidikan',
                        date: '2025-01-15T00:00:00.000Z',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    },
                    {
                        id: '2',
                        name: 'Workshop Kurikulum Merdeka',
                        description: 'Workshop implementasi kurikulum merdeka untuk pengawas sekolah',
                        organizer: 'Dinas Pendidikan Provinsi Jawa Barat',
                        location: 'Hotel Santika Garut',
                        date: '2025-01-30T00:00:00.000Z',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    },
                    {
                        id: '3',
                        name: 'Evaluasi Kinerja Sekolah Binaan',
                        description: 'Melakukan evaluasi kinerja sekolah binaan semester genap',
                        organizer: 'Cabang Dinas Pendidikan Wilayah XI',
                        location: 'Sekolah Binaan',
                        date: '2025-02-10T00:00:00.000Z',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    },
                    {
                        id: '4',
                        name: 'Pelatihan Supervisi Akademik',
                        description: 'Mengikuti pelatihan teknik supervisi akademik modern',
                        organizer: 'Pusat Pengembangan Profesi Pendidik',
                        location: 'Jakarta',
                        date: '2025-02-20T00:00:00.000Z',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    }
                ];
                
                // Restore original tasks data
                const originalTasks = [
                    {
                        id: '1',
                        title: 'Supervisi dan pembinaan Kepala SMKN 14 Garut',
                        description: 'Melakukan supervisi akademik dan pembinaan kepala sekolah',
                        category: 'Supervisi Akademik',
                        completed: true,
                        date: '2025-01-15T00:00:00.000Z',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    },
                    {
                        id: '2',
                        title: 'Evaluasi program sekolah penggerak SMKN 4 Garut',
                        description: 'Evaluasi implementasi program sekolah penggerak',
                        category: 'Evaluasi Program',
                        completed: false,
                        date: '2025-01-18T00:00:00.000Z',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    },
                    {
                        id: '3',
                        title: 'Monitoring Implementasi Kurikulum Merdeka',
                        description: 'Monitoring implementasi kurikulum merdeka di sekolah binaan',
                        category: 'Monitoring',
                        completed: false,
                        date: '2025-01-25T00:00:00.000Z',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    }
                ];
                
                // Restore original supervisions data
                const originalSupervisions = [
                    {
                        id: '1',
                        schoolName: 'SMKN 14 Garut',
                        type: 'Supervisi Akademik',
                        findings: 'Pembelajaran sudah sesuai kurikulum merdeka, namun perlu peningkatan dalam penggunaan teknologi',
                        recommendations: 'Tingkatkan penggunaan media pembelajaran digital dan platform e-learning',
                        notes: 'Supervisi berjalan lancar, kepala sekolah kooperatif',
                        date: '2025-01-15T00:00:00.000Z',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    },
                    {
                        id: '2',
                        schoolName: 'SMKN 4 Garut',
                        type: 'Supervisi Manajerial',
                        findings: 'Manajemen sekolah sudah baik, dokumentasi perlu diperbaiki',
                        recommendations: 'Perbaiki sistem dokumentasi dan arsip sekolah',
                        notes: 'Perlu follow up untuk dokumentasi',
                        date: '2025-01-18T00:00:00.000Z',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    },
                    {
                        id: '3',
                        schoolName: 'SMKN 1 Garut',
                        type: 'Supervisi Akademik',
                        findings: 'Proses pembelajaran berjalan baik, fasilitas memadai',
                        recommendations: 'Tingkatkan variasi metode pembelajaran',
                        notes: 'Sekolah sudah menerapkan pembelajaran berbasis proyek',
                        date: '2025-01-22T00:00:00.000Z',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    }
                ];
                
                // Restore original events data
                const originalEvents = [
                    {
                        id: '1',
                        title: 'Rapat Koordinasi Pengawas Sekolah',
                        description: 'Rapat koordinasi bulanan pengawas sekolah se-Kabupaten Garut',
                        date: '2025-01-15T00:00:00.000Z',
                        time: '09:00',
                        location: 'Aula Dinas Pendidikan',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    },
                    {
                        id: '2',
                        title: 'Workshop Implementasi Kurikulum Merdeka',
                        description: 'Workshop peningkatan kapasitas pengawas dalam implementasi kurikulum merdeka',
                        date: '2025-01-25T00:00:00.000Z',
                        time: '08:00',
                        location: 'Hotel Santika Garut',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    },
                    {
                        id: '3',
                        title: 'Seminar Pendidikan Karakter',
                        description: 'Seminar nasional tentang pendidikan karakter di era digital',
                        date: '2025-02-05T00:00:00.000Z',
                        time: '08:30',
                        location: 'Universitas Garut',
                        userId: 'wawan-123',
                        username: 'wawan',
                        createdBy: 'wawan'
                    }
                ];
                
                // Update database with original data
                database.tasks = originalTasks;
                database.supervisions = originalSupervisions;
                database.events = originalEvents;
                database.additionalTasks = originalAdditionalTasks;
                
                // Save to localStorage
                localStorage.setItem('local-database', JSON.stringify(database));
                localStorage.setItem('tasks', JSON.stringify(originalTasks));
                localStorage.setItem('supervisions', JSON.stringify(originalSupervisions));
                localStorage.setItem('events', JSON.stringify(originalEvents));
                localStorage.setItem('additional_tasks', JSON.stringify(originalAdditionalTasks));
                localStorage.setItem('additionalTasks', JSON.stringify(originalAdditionalTasks));
                
                console.log('‚úÖ Data restored successfully');
                
                statusDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ <strong>DATA BERHASIL DIRESTORE!</strong>
                        <br>Data tugas tambahan yang sebenarnya telah dipulihkan.
                        <br><strong>Total data:</strong>
                        <br>‚Ä¢ Tugas Pokok: ${originalTasks.length}
                        <br>‚Ä¢ Supervisi: ${originalSupervisions.length}
                        <br>‚Ä¢ Kegiatan: ${originalEvents.length}
                        <br>‚Ä¢ Tugas Tambahan: ${originalAdditionalTasks.length}
                        <br><br><strong>Refresh aplikasi React untuk melihat perubahan!</strong>
                    </div>
                `;
                
                // Auto-check current data
                setTimeout(() => {
                    checkCurrentData();
                }, 1000);
                
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="error">
                        ‚ùå <strong>RESTORE GAGAL!</strong>
                        <br>Error: ${error.message}
                    </div>
                `;
            }
        }

        function checkCurrentData() {
            const statusDiv = document.getElementById('currentDataStatus');
            
            try {
                const database = localStorage.getItem('local-database');
                if (database) {
                    const data = JSON.parse(database);
                    const totalActivities = (data.tasks?.length || 0) + (data.supervisions?.length || 0) + 
                                          (data.events?.length || 0) + (data.additionalTasks?.length || 0);
                    
                    statusDiv.innerHTML = `
                        <div class="info">
                            üìä <strong>Data Saat Ini:</strong>
                            <br>‚Ä¢ Tugas Pokok: ${data.tasks?.length || 0}
                            <br>‚Ä¢ Supervisi: ${data.supervisions?.length || 0}
                            <br>‚Ä¢ Kegiatan: ${data.events?.length || 0}
                            <br>‚Ä¢ Tugas Tambahan: ${data.additionalTasks?.length || 0}
                            <br><strong>Total: ${totalActivities} aktivitas</strong>
                            
                            <details style="margin-top: 10px;">
                                <summary>Detail Tugas Tambahan</summary>
                                <pre>${JSON.stringify(data.additionalTasks || [], null, 2)}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <div class="error">
                            ‚ùå Tidak ada data di localStorage
                        </div>
                    `;
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Error checking data: ${error.message}
                    </div>
                `;
            }
        }

        function showDebugInfo() {
            const debugOutput = document.getElementById('debugOutput');
            const debugData = {
                localStorage_keys: Object.keys(localStorage),
                local_database: localStorage.getItem('local-database'),
                tasks: localStorage.getItem('tasks'),
                additional_tasks: localStorage.getItem('additional_tasks'),
                additionalTasks: localStorage.getItem('additionalTasks')
            };
            
            debugOutput.innerHTML = `<pre>${JSON.stringify(debugData, null, 2)}</pre>`;
        }

        function backupCurrentData() {
            const data = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                data[key] = localStorage.getItem(key);
            }
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'backup_before_restore.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Auto-run check on page load
        window.onload = function() {
            console.log('üöÄ Restore tool loaded');
            checkCurrentData();
        };
    </script>
</body>
</html>