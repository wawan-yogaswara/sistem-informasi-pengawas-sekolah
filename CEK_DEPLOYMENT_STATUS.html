<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Cek Status Deployment Production</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border-radius: 10px;
        }
        .url-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        .url-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin: 10px 0;
        }
        .btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        .btn-success { background: linear-gradient(135deg, #4CAF50, #45a049); }
        .btn-warning { background: linear-gradient(135deg, #FF9800, #F57C00); }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { background: #e8f5e8; border-left: 5px solid #4CAF50; }
        .error { background: #ffebee; border-left: 5px solid #f44336; }
        .info { background: #e3f2fd; border-left: 5px solid #2196F3; }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .url-list {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .url-link {
            display: block;
            color: #155724;
            font-weight: bold;
            text-decoration: none;
            font-size: 16px;
            margin: 5px 0;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .url-link:hover {
            background: #f8f9fa;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Cek Status Deployment Production</h1>
            <p>Verifikasi URL Production dan Test Koneksi</p>
        </div>

        <div class="url-section">
            <h3>üåê URL Production yang Mungkin</h3>
            <div class="url-list">
                <a href="https://celadon-chebakia-a3bf18.netlify.app" target="_blank" class="url-link" onclick="setURL(this.href)">
                    https://celadon-chebakia-a3bf18.netlify.app (Netlify Production)
                </a>
                <a href="https://celadon-chebakia-a3bf18--deploy-preview-1.netlify.app" target="_blank" class="url-link" onclick="setURL(this.href)">
                    https://celadon-chebakia-a3bf18--deploy-preview-1.netlify.app (Deploy Preview)
                </a>
                <a href="https://celadon-chebakia-a3bf18--main.netlify.app" target="_blank" class="url-link" onclick="setURL(this.href)">
                    https://celadon-chebakia-a3bf18--main.netlify.app (Branch Deploy)
                </a>
            </div>
        </div>

        <div class="url-section">
            <h3>üîß Test URL Custom</h3>
            <input type="text" id="customURL" class="url-input" placeholder="Masukkan URL production Anda..." value="https://celadon-chebakia-a3bf18.netlify.app">
            <button class="btn btn-success" onclick="testCustomURL()">Test URL Ini</button>
        </div>

        <div class="url-section">
            <h3>üìä Hasil Test</h3>
            <div id="test-result" class="result info">Klik salah satu URL di atas atau masukkan URL custom untuk memulai test...</div>
        </div>

        <div class="url-section">
            <h3>üöÄ Test Lengkap (Setelah URL Benar)</h3>
            <button class="btn btn-warning" onclick="runFullTest()">Jalankan Test Lengkap</button>
            <div id="full-test-result" class="result"></div>
        </div>
    </div>

    <script>
        let currentURL = 'https://celadon-chebakia-a3bf18.netlify.app';

        function setURL(url) {
            currentURL = url;
            document.getElementById('customURL').value = url;
            testURL(url);
        }

        function testCustomURL() {
            const url = document.getElementById('customURL').value.trim();
            if (url) {
                currentURL = url;
                testURL(url);
            } else {
                showResult('test-result', '‚ùå Masukkan URL yang valid!', 'error');
            }
        }

        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.innerHTML = content;
        }

        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = '<div class="loading"></div> Testing...';
        }

        async function testURL(url) {
            showLoading('test-result');
            
            try {
                // Test 1: Basic connectivity
                const response = await fetch(url, { 
                    method: 'GET',
                    mode: 'cors'
                });
                
                let result = `üîç TEST KONEKSI URL: ${url}\n\n`;
                result += `Status: ${response.status} ${response.statusText}\n`;
                result += `Headers: ${JSON.stringify(Object.fromEntries(response.headers), null, 2)}\n\n`;
                
                if (response.ok) {
                    result += `‚úÖ URL ACCESSIBLE!\n\n`;
                    
                    // Test 2: API endpoints
                    result += `üîç Testing API endpoints...\n`;
                    
                    try {
                        const apiResponse = await fetch(`${url}/api/auth/me`);
                        result += `API /auth/me: ${apiResponse.status} ${apiResponse.statusText}\n`;
                        
                        if (apiResponse.status === 401 || apiResponse.status === 200) {
                            result += `‚úÖ API endpoints working!\n\n`;
                            
                            // Test 3: Users endpoint
                            try {
                                const usersResponse = await fetch(`${url}/api/users`);
                                const usersData = await usersResponse.json();
                                
                                if (usersResponse.ok && Array.isArray(usersData)) {
                                    result += `‚úÖ Users API: ${usersData.length} users found\n`;
                                    result += `Users: ${usersData.map(u => u.username).join(', ')}\n\n`;
                                    
                                    result += `üéâ PRODUCTION URL WORKING!\n`;
                                    result += `üîë Login credentials:\n`;
                                    result += `   Username: wawan | Password: admin123\n`;
                                    result += `   Username: yenihandayani | Password: admin123\n`;
                                    result += `   Username: itasdik | Password: admin123\n`;
                                    result += `   Username: admin | Password: admin123\n`;
                                    
                                    showResult('test-result', result, 'success');
                                } else {
                                    result += `‚ùå Users API failed: ${usersResponse.status}\n`;
                                    showResult('test-result', result, 'error');
                                }
                            } catch (error) {
                                result += `‚ùå Users API error: ${error.message}\n`;
                                showResult('test-result', result, 'error');
                            }
                        } else {
                            result += `‚ùå API endpoints not working properly\n`;
                            showResult('test-result', result, 'error');
                        }
                    } catch (error) {
                        result += `‚ùå API test error: ${error.message}\n`;
                        showResult('test-result', result, 'error');
                    }
                } else {
                    result += `‚ùå URL NOT ACCESSIBLE!\n`;
                    result += `This might be:\n`;
                    result += `- Wrong URL\n`;
                    result += `- Deployment not ready\n`;
                    result += `- CORS issues\n`;
                    showResult('test-result', result, 'error');
                }
                
            } catch (error) {
                let result = `‚ùå CONNECTION ERROR!\n\n`;
                result += `URL: ${url}\n`;
                result += `Error: ${error.message}\n\n`;
                result += `Possible causes:\n`;
                result += `- URL tidak valid\n`;
                result += `- Deployment belum selesai\n`;
                result += `- Network issues\n`;
                result += `- CORS policy\n`;
                
                showResult('test-result', result, 'error');
            }
        }

        async function runFullTest() {
            showLoading('full-test-result');
            
            let results = [];
            
            try {
                results.push(`üöÄ FULL PRODUCTION TEST`);
                results.push(`URL: ${currentURL}`);
                results.push(`=`.repeat(50));
                
                // Test 1: Users
                results.push(`\nüë• Testing Users...`);
                const usersResponse = await fetch(`${currentURL}/api/users`);
                const usersData = await usersResponse.json();
                
                if (usersResponse.ok && Array.isArray(usersData)) {
                    results.push(`‚úÖ Users: ${usersData.length} found`);
                    usersData.forEach((user, i) => {
                        results.push(`   ${i+1}. ${user.full_name} (${user.username})`);
                    });
                } else {
                    results.push(`‚ùå Users: FAILED`);
                }
                
                // Test 2: Schools
                results.push(`\nüè´ Testing Schools...`);
                const schoolsResponse = await fetch(`${currentURL}/api/schools`);
                const schoolsData = await schoolsResponse.json();
                
                if (schoolsResponse.ok && Array.isArray(schoolsData)) {
                    results.push(`‚úÖ Schools: ${schoolsData.length} found`);
                    schoolsData.slice(0, 3).forEach((school, i) => {
                        results.push(`   ${i+1}. ${school.name}`);
                    });
                    if (schoolsData.length > 3) {
                        results.push(`   ... dan ${schoolsData.length - 3} lainnya`);
                    }
                } else {
                    results.push(`‚ùå Schools: FAILED`);
                }
                
                // Test 3: Additional Tasks
                results.push(`\nüìã Testing Additional Tasks...`);
                const tasksResponse = await fetch(`${currentURL}/api/additional-tasks`);
                const tasksData = await tasksResponse.json();
                
                if (tasksResponse.ok && Array.isArray(tasksData)) {
                    results.push(`‚úÖ Additional Tasks: ${tasksData.length} found`);
                    tasksData.forEach((task, i) => {
                        results.push(`   ${i+1}. ${task.name} - ${task.location}`);
                    });
                } else {
                    results.push(`‚ùå Additional Tasks: FAILED`);
                }
                
                // Test 4: Login
                results.push(`\nüîê Testing Login...`);
                const loginResponse = await fetch(`${currentURL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'wawan', password: 'admin123' })
                });
                const loginData = await loginResponse.json();
                
                if (loginResponse.ok && loginData.user) {
                    results.push(`‚úÖ Login: SUCCESS`);
                    results.push(`   User: ${loginData.user.full_name}`);
                    results.push(`   Role: ${loginData.user.role}`);
                } else {
                    results.push(`‚ùå Login: FAILED`);
                }
                
                results.push(`\nüéØ SUMMARY:`);
                const successCount = results.filter(r => r.includes('‚úÖ')).length;
                results.push(`‚úÖ Passed: ${successCount}/4 tests`);
                
                if (successCount === 4) {
                    results.push(`\nüöÄ ALL TESTS PASSED!`);
                    results.push(`Production is ready to use!`);
                    showResult('full-test-result', results.join('\n'), 'success');
                } else {
                    results.push(`\n‚ö†Ô∏è Some tests failed.`);
                    showResult('full-test-result', results.join('\n'), 'error');
                }
                
            } catch (error) {
                results.push(`\n‚ùå FULL TEST ERROR: ${error.message}`);
                showResult('full-test-result', results.join('\n'), 'error');
            }
        }

        // Auto-test first URL on page load
        window.onload = function() {
            setTimeout(() => testURL(currentURL), 1000);
        };
    </script>
</body>
</html>