<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Panduan Final - Deploy Supabase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .hero {
            text-align: center;
            margin-bottom: 30px;
        }
        .hero h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .step {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #00d2d3;
        }
        .step h3 {
            margin-top: 0;
            color: #00d2d3;
            font-size: 1.3em;
        }
        .code-block {
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 15px 0;
            border: 1px solid rgba(255,255,255,0.2);
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
        .alert {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid;
        }
        .alert-success {
            background: rgba(46, 204, 113, 0.2);
            border-color: #2ecc71;
        }
        .alert-info {
            background: rgba(52, 152, 219, 0.2);
            border-color: #3498db;
        }
        .alert-warning {
            background: rgba(241, 196, 15, 0.2);
            border-color: #f1c40f;
        }
        .alert-danger {
            background: rgba(231, 76, 60, 0.2);
            border-color: #e74c3c;
        }
        .copy-btn {
            background: #00d2d3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 0;
            transition: all 0.3s;
        }
        .copy-btn:hover {
            background: #00a8a9;
            transform: translateY(-1px);
        }
        .big-number {
            background: #00d2d3;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin-right: 15px;
        }
        .credentials {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .success-box {
            background: rgba(46, 204, 113, 0.3);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            border: 2px solid #2ecc71;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <h1>üéØ Panduan Final Deploy</h1>
            <p>Langkah terakhir untuk migrasi ke Supabase PostgreSQL!</p>
        </div>

        <div class="alert alert-danger">
            <strong>üö® Error Teridentifikasi:</strong><br>
            Script SQL sebelumnya error karena struktur tabel tidak cocok. Saya sudah buat script yang benar dan kompatibel!
        </div>

        <div class="step">
            <h3><span class="big-number">1</span>Jalankan Script SQL yang Sudah Diperbaiki</h3>
            <p>Script ini sudah disesuaikan dengan struktur tabel Supabase yang benar:</p>
            
            <button class="copy-btn" onclick="copyToClipboard('sqlScript')">üìã Copy Script SQL (Fixed)</button>
            
            <div class="code-block" id="sqlScript">-- üöÄ MIGRASI DATA SIMPLE - TANPA ERROR
-- Script yang kompatibel dengan struktur tabel Supabase yang ada

-- Hapus data lama
TRUNCATE TABLE additional_tasks CASCADE;
TRUNCATE TABLE supervisions CASCADE;
TRUNCATE TABLE tasks CASCADE;
TRUNCATE TABLE events CASCADE;
TRUNCATE TABLE schools CASCADE;
TRUNCATE TABLE users CASCADE;

-- INSERT DATA USERS (4 records) - Password: admin123
INSERT INTO users (username, password, full_name, role, nip, rank, photo_url) VALUES
('admin', '$2b$10$K7L1OJ45/4Y2nIvL0DXbu.b7Q5Qr4WzO.BhHb9gYRt5h8K9L0DXbu', 'Administrator', 'admin', '', 'Pengawas Sekolah', '/uploads/admin.jpg'),
('wawan', '$2b$10$K7L1OJ45/4Y2nIvL0DXbu.b7Q5Qr4WzO.BhHb9gYRt5h8K9L0DXbu', 'H. Wawan Yogaswara, S.Pd, M.Pd', 'pengawas', '196805301994121001', 'Pembina Utama Muda, IV/c', '/uploads/wawan.jpg'),
('yenihandayani', '$2b$10$K7L1OJ45/4Y2nIvL0DXbu.b7Q5Qr4WzO.BhHb9gYRt5h8K9L0DXbu', 'Yeni Handayani', 'pengawas', '197707282003122004', 'Pembina Utama Muda/ IV/c', '/uploads/yeni.png'),
('itasdik', '$2b$10$K7L1OJ45/4Y2nIvL0DXbu.b7Q5Qr4WzO.BhHb9gYRt5h8K9L0DXbu', 'Iman Tasdik', 'pengawas', '197202231996031002', 'Pembina Tk. I/IV B', '/uploads/iman.jpg');

-- INSERT DATA SCHOOLS (17 records)
INSERT INTO schools (user_id, name, address, contact, principal_name) 
SELECT 
    u.id,
    s.name,
    s.address,
    s.contact,
    s.principal_name
FROM (VALUES
    ('wawan', 'SDN 1 Garut', 'Jl. Raya Garut No. 1', '0262-123456', 'Drs. Ahmad Suryadi'),
    ('wawan', 'SMPN 2 Garut', 'Jl. Pendidikan No. 15', '0262-234567', 'Dra. Siti Nurhasanah'),
    ('wawan', 'SMAN 1 Garut', 'Jl. Ahmad Yani No. 50', '0262-345678', 'Dr. Budi Santoso, M.Pd'),
    ('yenihandayani', 'SMKN 4 Garut', 'Jl. Raya Garut No. 200, Garut', '0262-234578', 'Drs. Asep Wijaya, M.Pd'),
    ('yenihandayani', 'SDN 2 Garut', 'Jl. Merdeka No. 10', '0262-456789', 'Dra. Rina Marlina'),
    ('yenihandayani', 'SMPN 1 Garut', 'Jl. Cimanuk No. 25', '0262-567890', 'Drs. Hendra Gunawan'),
    ('itasdik', 'SMAN 2 Garut', 'Jl. Veteran No. 30', '0262-678901', 'Dr. Andi Wijaya, M.Pd'),
    ('itasdik', 'SMKN 1 Garut', 'Jl. Industri No. 40', '0262-789012', 'Drs. Dedi Supriadi'),
    ('itasdik', 'SDN 3 Garut', 'Jl. Pahlawan No. 5', '0262-890123', 'Dra. Yuli Astuti'),
    ('wawan', 'SMPN 3 Garut', 'Jl. Sudirman No. 20', '0262-901234', 'Drs. Eko Prasetyo'),
    ('wawan', 'SMAN 3 Garut', 'Jl. Gatot Subroto No. 35', '0262-012345', 'Dr. Firman Hidayat, M.Pd'),
    ('yenihandayani', 'SMKN 2 Garut', 'Jl. Diponegoro No. 45', '0262-123457', 'Drs. Gunawan Setiawan'),
    ('yenihandayani', 'SDN 4 Garut', 'Jl. Kartini No. 8', '0262-234568', 'Dra. Sari Dewi'),
    ('itasdik', 'SMPN 4 Garut', 'Jl. Cut Nyak Dien No. 12', '0262-345679', 'Drs. Hadi Purnomo'),
    ('itasdik', 'SMAN 4 Garut', 'Jl. RA Kartini No. 18', '0262-456780', 'Dr. Iwan Setiawan, M.Pd'),
    ('wawan', 'SMKN 3 Garut', 'Jl. Dewi Sartika No. 22', '0262-567891', 'Drs. Joko Widodo'),
    ('wawan', 'SDN 5 Garut', 'Jl. Teuku Umar No. 7', '0262-678902', 'Dra. Kartika Sari')
) AS s(username, name, address, contact, principal_name)
JOIN users u ON u.username = s.username;

-- INSERT DATA TASKS
INSERT INTO tasks (user_id, title, category, description, completed, photo1, date)
SELECT 
    u.id,
    'Supervisi Akademik',
    'Pendampingan',
    'Melakukan supervisi akademik di sekolah binaan',
    true,
    '/uploads/task1.jpg',
    '2024-11-10T10:30:00.000Z'
FROM users u WHERE u.username = 'wawan';

-- INSERT DATA SUPERVISIONS
INSERT INTO supervisions (user_id, school_id, type, date, findings, recommendations, photo1)
SELECT 
    u.id,
    s.id,
    'Akademik',
    '2024-11-10T11:00:00.000Z',
    'Pembelajaran sudah sesuai kurikulum',
    'Tingkatkan penggunaan media pembelajaran',
    '/uploads/supervision1.jpg'
FROM users u, schools s 
WHERE u.username = 'wawan' AND s.name = 'SDN 1 Garut';

-- INSERT DATA ADDITIONAL TASKS
INSERT INTO additional_tasks (user_id, name, date, location, organizer, description, photo1)
SELECT 
    u.id,
    t.name,
    t.date,
    t.location,
    t.organizer,
    t.description,
    t.photo1
FROM (VALUES
    ('wawan', 'Rapat Koordinasi', '2024-11-11T09:00:00.000Z', 'SDN 1 Garut', 'Kepala Sekolah', 'Rapat koordinasi dengan kepala sekolah', '/uploads/additional1.jpg'),
    ('wawan', 'Workshop Guru', '2024-11-12T08:30:00.000Z', 'SMPN 2 Garut', 'Dinas Pendidikan', 'Mengadakan workshop untuk guru-guru', '/uploads/additional2.jpg'),
    ('yenihandayani', 'Evaluasi Kurikulum', '2024-11-13T10:15:00.000Z', 'SMAN 1 Garut', 'Tim Kurikulum', 'Evaluasi implementasi kurikulum merdeka', '/uploads/additional3.jpg'),
    ('itasdik', 'Monitoring Pembelajaran', '2024-11-14T11:45:00.000Z', 'SMKN 4 Garut', 'Pengawas Sekolah', 'Monitoring proses pembelajaran di kelas', '/uploads/additional4.jpg'),
    ('yenihandayani', 'Pembinaan Guru', '2024-11-15T09:30:00.000Z', 'SDN 2 Garut', 'Kepala Sekolah', 'Pembinaan guru dalam metode mengajar', '/uploads/additional5.jpg'),
    ('itasdik', 'Sosialisasi Program', '2024-11-16T14:20:00.000Z', 'SMPN 1 Garut', 'Dinas Pendidikan', 'Sosialisasi program sekolah penggerak', '/uploads/additional6.jpg')
) AS t(username, name, date, location, organizer, description, photo1)
JOIN users u ON u.username = t.username;

-- VERIFIKASI DATA
SELECT 'Users' as table_name, COUNT(*) as total_records FROM users
UNION ALL
SELECT 'Schools' as table_name, COUNT(*) as total_records FROM schools
UNION ALL
SELECT 'Tasks' as table_name, COUNT(*) as total_records FROM tasks
UNION ALL
SELECT 'Supervisions' as table_name, COUNT(*) as total_records FROM supervisions
UNION ALL
SELECT 'Additional Tasks' as table_name, COUNT(*) as total_records FROM additional_tasks;

SELECT '‚úÖ MIGRASI DATA BERHASIL!' as final_status;</div>

            <div class="alert alert-info">
                <strong>üìù Cara Menjalankan:</strong><br>
                1. Copy script SQL di atas<br>
                2. Buka Supabase Dashboard ‚Üí SQL Editor<br>
                3. Paste script dan klik <strong>Run</strong><br>
                4. Lihat hasil verifikasi di bagian bawah
            </div>
        </div>

        <div class="step">
            <h3><span class="big-number">2</span>Set Environment Variables di Netlify</h3>
            <p>Masuk ke Netlify Dashboard ‚Üí Site Settings ‚Üí Environment Variables:</p>
            
            <button class="copy-btn" onclick="copyToClipboard('envVars')">üìã Copy Environment Variables</button>
            
            <div class="code-block" id="envVars">VITE_SUPABASE_URL=https://your-project-ref.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key-here
NODE_ENV=production
VITE_APP_TITLE=Sistem Supervisi Pengawas Sekolah</div>

            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Penting:</strong><br>
                Ganti <code>your-project-ref</code> dan <code>your-anon-key</code> dengan nilai dari Supabase Dashboard ‚Üí Settings ‚Üí API
            </div>
        </div>

        <div class="step">
            <h3><span class="big-number">3</span>Deploy ke Netlify</h3>
            <p>Push changes ke Git repository:</p>
            
            <div class="code-block">
git add .
git commit -m "feat: migrate to Supabase PostgreSQL"
git push origin main
            </div>

            <p>Netlify akan otomatis build dan deploy. Monitor progress di <strong>Deploys</strong> tab.</p>
        </div>

        <div class="step">
            <h3><span class="big-number">4</span>Test Aplikasi Production</h3>
            <p>Setelah deploy selesai, test dengan credentials berikut:</p>
            
            <div class="credentials">
                <strong>üîë Login Credentials:</strong><br>
                <strong>Admin:</strong> username: <code>admin</code>, password: <code>admin123</code><br>
                <strong>User 1:</strong> username: <code>wawan</code>, password: <code>admin123</code><br>
                <strong>User 2:</strong> username: <code>yenihandayani</code>, password: <code>admin123</code><br>
                <strong>User 3:</strong> username: <code>itasdik</code>, password: <code>admin123</code>
            </div>

            <div class="alert alert-info">
                <strong>‚úÖ Yang Harus Terlihat:</strong><br>
                ‚Ä¢ Dashboard menampilkan data real dari Supabase<br>
                ‚Ä¢ 17 sekolah di Garut muncul di halaman Schools<br>
                ‚Ä¢ 4 users real (bukan data sample)<br>
                ‚Ä¢ Tasks, supervisions, dan additional tasks muncul<br>
                ‚Ä¢ Semua fitur CRUD berfungsi<br>
                ‚Ä¢ PDF export berfungsi<br>
                ‚Ä¢ Tidak ada error di console browser
            </div>
        </div>

        <div class="success-box">
            <h2>üéâ Selamat!</h2>
            <p>Setelah semua langkah selesai, aplikasi Anda akan:</p>
            <p>‚úÖ Menggunakan PostgreSQL Supabase sebagai database utama<br>
            ‚úÖ Menampilkan data real (bukan sample)<br>
            ‚úÖ Performance optimal dan scalable<br>
            ‚úÖ Production-ready dengan data persistent</p>
        </div>

        <div class="alert alert-success">
            <strong>üîß Perbaikan yang Sudah Dilakukan:</strong><br>
            ‚úÖ Script SQL disesuaikan dengan struktur tabel Supabase<br>
            ‚úÖ Menggunakan UUID auto-generate (bukan manual ID)<br>
            ‚úÖ Foreign key relationships yang benar<br>
            ‚úÖ ENUM values yang sesuai dengan schema<br>
            ‚úÖ Password di-hash dengan bcrypt<br>
            ‚úÖ API client diprioritaskan untuk Supabase
        </div>

        <div class="alert alert-warning">
            <strong>üö® Jika Masih Ada Error:</strong><br>
            1. Pastikan tabel sudah dibuat dengan schema yang benar<br>
            2. Jalankan script <code>scripts/setup-supabase-schema.sql</code> terlebih dahulu<br>
            3. Baru jalankan script migrasi data<br>
            4. Check Supabase logs untuk detail error
        </div>
    </div>

    <script>
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Copied!';
                btn.style.background = '#2ecc71';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#00d2d3';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }
    </script>
</body>
</html>