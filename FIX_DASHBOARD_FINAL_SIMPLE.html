<!DOCTYPE html>
<html>
<head>
    <title>Fix Dashboard Final - Inject Real Data</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .step { background: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #2196f3; }
        .code { background: #f5f5f5; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; margin: 10px 0; }
        .success { background: #e8f5e8; border-left-color: #4caf50; }
        .warning { background: #fff3e0; border-left-color: #ff9800; }
        .error { background: #ffebee; border-left-color: #f44336; }
        button { background: #2196f3; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #1976d2; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Fix Dashboard Final - Inject Real Data</h1>
        <p><strong>Solusi sederhana untuk mengatasi masalah dashboard yang tidak menampilkan data statistik, nama user, dan foto user.</strong></p>

        <div class="step warning">
            <h3>âš ï¸ Masalah yang Diatasi:</h3>
            <ul>
                <li>Data statistik menampilkan angka 0</li>
                <li>Nama user tidak muncul di dashboard</li>
                <li>Foto profil user tidak tampil</li>
                <li>Data tidak tersinkronisasi dengan localStorage</li>
            </ul>
        </div>

        <div class="step">
            <h3>ğŸ“‹ Langkah 1: Buka Dashboard</h3>
            <p>1. Pastikan server sudah berjalan</p>
            <p>2. Buka <strong>http://localhost:5173</strong> di browser</p>
            <p>3. Login dengan user yang sudah ada</p>
            <p>4. Masuk ke halaman Dashboard</p>
        </div>

        <div class="step">
            <h3>ğŸ”§ Langkah 2: Buka Console Browser</h3>
            <p>1. Tekan <strong>F12</strong> atau klik kanan â†’ Inspect Element</p>
            <p>2. Pilih tab <strong>Console</strong></p>
            <p>3. Copy dan paste script di bawah ini:</p>
        </div>

        <div class="step success">
            <h3>ğŸš€ Script Inject Data Real</h3>
            <button onclick="copyScript()">ğŸ“‹ Copy Script</button>
            <div class="code" id="mainScript">
// ğŸš€ SCRIPT INJECT DATA REAL KE DASHBOARD
console.log('ğŸ”„ Starting dashboard data injection...');

// 1. Load data dari local-database.json
async function loadRealData() {
    try {
        console.log('ğŸ“‚ Loading real data from local-database.json...');
        
        // Fetch data dari file local-database.json
        const response = await fetch('/local-database.json');
        const realData = await response.json();
        
        console.log('âœ… Real data loaded:', {
            users: realData.users?.length || 0,
            tasks: realData.tasks?.length || 0,
            supervisions: realData.supervisions?.length || 0,
            schools: realData.schools?.length || 0,
            additionalTasks: realData.additionalTasks?.length || 0
        });
        
        // 2. Inject ke localStorage
        localStorage.setItem('local-database', JSON.stringify(realData));
        console.log('ğŸ’¾ Data injected to localStorage');
        
        // 3. Setup current user dengan data lengkap
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        console.log('ğŸ‘¤ Current user before update:', currentUser);
        
        // Cari user data yang lengkap dari realData
        const fullUserData = realData.users?.find(user => 
            user.username === currentUser.username || 
            user.id === currentUser.id
        );
        
        if (fullUserData) {
            const updatedUser = {
                ...currentUser,
                ...fullUserData,
                fullName: fullUserData.fullName || fullUserData.name || currentUser.username,
                photoUrl: fullUserData.photoUrl || fullUserData.photo || null
            };
            
            localStorage.setItem('currentUser', JSON.stringify(updatedUser));
            console.log('âœ… Current user updated with full data:', updatedUser);
        }
        
        // 4. Trigger dashboard refresh
        console.log('ğŸ”„ Refreshing dashboard...');
        window.location.reload();
        
        return true;
    } catch (error) {
        console.error('âŒ Error loading real data:', error);
        return false;
    }
}

// 5. Execute injection
loadRealData().then(success => {
    if (success) {
        console.log('ğŸ‰ Dashboard data injection completed successfully!');
    } else {
        console.log('âš ï¸ Dashboard data injection failed, trying alternative method...');
        
        // Alternative: Manual data setup
        const demoData = {
            users: [
                {
                    id: 'wawan123',
                    username: 'wawan',
                    fullName: 'Wawan Setiawan',
                    nip: '196801011990031001',
                    role: 'user',
                    photoUrl: '/uploads/wawan-profile.jpg'
                }
            ],
            tasks: [
                { id: 1, title: 'Supervisi Pembelajaran', username: 'wawan', completed: true, date: '2024-12-20' },
                { id: 2, title: 'Evaluasi Kurikulum', username: 'wawan', completed: false, date: '2024-12-21' },
                { id: 3, title: 'Monitoring Guru', username: 'wawan', completed: true, date: '2024-12-19' }
            ],
            supervisions: [
                { id: 1, title: 'Supervisi SDN 1', username: 'wawan', schoolName: 'SDN 1 Garut', date: '2024-12-20' },
                { id: 2, title: 'Supervisi SDN 2', username: 'wawan', schoolName: 'SDN 2 Garut', date: '2024-12-18' }
            ],
            schools: [
                { id: 1, name: 'SDN 1 Garut', address: 'Jl. Raya No. 1' },
                { id: 2, name: 'SDN 2 Garut', address: 'Jl. Raya No. 2' },
                { id: 3, name: 'SDN 3 Garut', address: 'Jl. Raya No. 3' }
            ],
            additionalTasks: [
                { id: 1, title: 'Pelatihan Guru', username: 'wawan', date: '2024-12-21' }
            ]
        };
        
        localStorage.setItem('local-database', JSON.stringify(demoData));
        
        // Update current user
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        const updatedUser = {
            ...currentUser,
            fullName: 'Wawan Setiawan',
            nip: '196801011990031001',
            photoUrl: '/uploads/wawan-profile.jpg',
            role: 'user'
        };
        localStorage.setItem('currentUser', JSON.stringify(updatedUser));
        
        console.log('âœ… Demo data injected successfully!');
        window.location.reload();
    }
});
            </div>
        </div>

        <div class="step">
            <h3>ğŸ¯ Langkah 3: Jalankan Script</h3>
            <p>1. Paste script di console browser</p>
            <p>2. Tekan <strong>Enter</strong></p>
            <p>3. Tunggu proses selesai (halaman akan refresh otomatis)</p>
            <p>4. Dashboard akan menampilkan data real</p>
        </div>

        <div class="step success">
            <h3>âœ… Hasil yang Diharapkan:</h3>
            <ul>
                <li>âœ… Nama user muncul di header dashboard</li>
                <li>âœ… Foto profil user tampil (jika ada)</li>
                <li>âœ… Data statistik menampilkan angka real (bukan 0)</li>
                <li>âœ… Aktivitas terbaru muncul dengan data real</li>
                <li>âœ… Progress bar menampilkan persentase yang benar</li>
            </ul>
        </div>

        <div class="step warning">
            <h3>ğŸ”§ Jika Masih Bermasalah:</h3>
            <p><strong>Alternatif 1: Manual Refresh</strong></p>
            <button onclick="manualRefresh()">ğŸ”„ Manual Refresh Dashboard</button>
            
            <p><strong>Alternatif 2: Clear Cache</strong></p>
            <button onclick="clearCache()">ğŸ—‘ï¸ Clear Browser Cache</button>
            
            <p><strong>Alternatif 3: Reset Data</strong></p>
            <button onclick="resetData()">ğŸ”„ Reset All Data</button>
        </div>

        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        function copyScript() {
            const script = document.getElementById('mainScript').textContent;
            navigator.clipboard.writeText(script).then(() => {
                alert('âœ… Script berhasil di-copy! Paste di console browser.');
            });
        }

        function manualRefresh() {
            const result = document.getElementById('result');
            result.style.display = 'block';
            result.className = 'result step';
            result.innerHTML = '<h4>ğŸ”„ Manual Refresh Dashboard</h4><p>Jalankan script ini di console:</p><div class="code">window.location.reload();</div>';
        }

        function clearCache() {
            const result = document.getElementById('result');
            result.style.display = 'block';
            result.className = 'result step warning';
            result.innerHTML = '<h4>ğŸ—‘ï¸ Clear Browser Cache</h4><p>Jalankan script ini di console:</p><div class="code">localStorage.clear();\nsessionStorage.clear();\nwindow.location.reload();</div>';
        }

        function resetData() {
            const result = document.getElementById('result');
            result.style.display = 'block';
            result.className = 'result step error';
            result.innerHTML = '<h4>ğŸ”„ Reset All Data</h4><p>Jalankan script ini di console:</p><div class="code">// Reset semua data\nlocalStorage.removeItem("local-database");\nlocalStorage.removeItem("currentUser");\n\n// Set user default\nconst defaultUser = {\n    username: "wawan",\n    fullName: "Wawan Setiawan",\n    nip: "196801011990031001",\n    role: "user",\n    photoUrl: "/uploads/wawan-profile.jpg"\n};\nlocalStorage.setItem("currentUser", JSON.stringify(defaultUser));\n\nwindow.location.reload();</div>';
        }
    </script>
</body>
</html>