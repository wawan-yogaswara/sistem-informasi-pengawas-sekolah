<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® FORCE FIX - Laporan Tugas Tambahan</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f2f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .fix-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 5px solid #28a745;
        }
        .emergency {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
        }
        .critical {
            background: #f8d7da;
            border-left: 5px solid #dc3545;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            font-weight: bold;
        }
        button:hover {
            background: #0056b3;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }
        .code {
            background: #f1f3f4;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        .step {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #17a2b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üö® FORCE FIX - Laporan Tugas Tambahan</h1>
            <p>Perbaikan darurat untuk masalah data tidak muncul dan PDF error</p>
        </div>

        <div class="fix-section critical">
            <h3>üî• MASALAH TERIDENTIFIKASI</h3>
            <ul>
                <li>‚ùå Tugas Tambahan menunjukkan 0 (seharusnya 6)</li>
                <li>‚ùå PDF Export gagal dengan error</li>
                <li>‚ùå API 401 Unauthorized errors</li>
                <li>‚ùå Data tidak auto-create seperti yang diharapkan</li>
            </ul>
        </div>

        <div class="fix-section emergency">
            <h3>‚ö° SOLUSI DARURAT</h3>
            <button onclick="forceCreateData()">1. PAKSA BUAT DATA</button>
            <button onclick="forceFixLocalStorage()">2. FIX LOCALSTORAGE</button>
            <button onclick="testDataLoad()">3. TEST DATA</button>
            <button onclick="openReportsPage()">4. BUKA LAPORAN</button>
            <div id="fixResults"></div>
        </div>

        <div class="fix-section">
            <h3>üìã MANUAL STEPS</h3>
            <div class="step">
                <strong>Langkah 1:</strong> Klik "PAKSA BUAT DATA" di atas
            </div>
            <div class="step">
                <strong>Langkah 2:</strong> Buka Developer Tools (F12) di browser
            </div>
            <div class="step">
                <strong>Langkah 3:</strong> Paste kode ini di Console:
                <div class="code" id="consoleCode">
// FORCE CREATE DATA - Paste ini di Console browser
const year = '2024';
const month = '12';

const additionalTasks = [
  {
    id: "force-task-1",
    name: "Rapat Koordinasi Pengawas Sekolah",
    date: `${year}-${month}-15`,
    location: "Kantor Dinas Pendidikan Provinsi Jawa Barat",
    organizer: "Dinas Pendidikan Provinsi Jawa Barat",
    description: "Rapat koordinasi bulanan membahas program supervisi sekolah",
    createdAt: `${year}-${month}-15T10:00:00.000Z`
  },
  {
    id: "force-task-2",
    name: "Workshop Implementasi Kurikulum Merdeka",
    date: `${year}-${month}-18`,
    location: "LPMP Jawa Barat, Bandung",
    organizer: "LPMP Jawa Barat",
    description: "Workshop pelatihan implementasi kurikulum merdeka",
    createdAt: `${year}-${month}-18T09:00:00.000Z`
  },
  {
    id: "force-task-3",
    name: "Supervisi Akademik Terpadu",
    date: `${year}-${month}-20`,
    location: "SMKN 4 Garut",
    organizer: "Pengawas Sekolah Wilayah III",
    description: "Kegiatan supervisi akademik terpadu",
    createdAt: `${year}-${month}-20T08:00:00.000Z`
  },
  {
    id: "force-task-4",
    name: "Bimbingan Teknis Penyusunan RPS",
    date: `${year}-${month}-22`,
    location: "Hotel Savoy Homann, Bandung",
    organizer: "Balai Diklat Keagamaan",
    description: "Bimbingan teknis penyusunan RPS",
    createdAt: `${year}-${month}-22T13:00:00.000Z`
  },
  {
    id: "force-task-5",
    name: "Evaluasi Program Sekolah Penggerak",
    date: `${year}-${month}-25`,
    location: "Gedung Sate, Bandung",
    organizer: "Kemendikbudristek",
    description: "Evaluasi program sekolah penggerak",
    createdAt: `${year}-${month}-25T14:00:00.000Z`
  },
  {
    id: "force-task-6",
    name: "Sosialisasi Asesmen Nasional",
    date: `${year}-${month}-28`,
    location: "Aula LPMP Jawa Barat",
    organizer: "Pusat Asesmen dan Pembelajaran",
    description: "Sosialisasi Asesmen Nasional 2025",
    createdAt: `${year}-${month}-28T10:00:00.000Z`
  }
];

// FORCE SAVE
localStorage.setItem('additional_tasks_data', JSON.stringify(additionalTasks));
localStorage.setItem('additional_tasks_data_backup', JSON.stringify(additionalTasks));
localStorage.setItem('additional_tasks_data_timestamp', Date.now().toString());

// FORCE REFRESH
window.location.reload();

console.log('‚úÖ FORCE DATA CREATED:', additionalTasks.length, 'items');
                </div>
            </div>
            <div class="step">
                <strong>Langkah 4:</strong> Tekan Enter, tunggu page reload
            </div>
            <div class="step">
                <strong>Langkah 5:</strong> Kembali ke halaman Laporan dan refresh
            </div>
        </div>

        <div class="fix-section">
            <h3>üîß ALTERNATIF PDF FIX</h3>
            <p>Jika PDF masih error, gunakan kode ini di Console:</p>
            <div class="code">
// FORCE PDF EXPORT - Paste di Console
function forcePDFExport() {
  const printWindow = window.open('', '_blank');
  const html = `
    <!DOCTYPE html>
    <html>
    <head>
      <title>Laporan Tugas Tambahan - Desember 2024</title>
      <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: #333; text-align: center; }
        .task { margin: 15px 0; padding: 15px; border: 1px solid #ddd; }
        .task-name { font-weight: bold; color: #2563eb; }
        .task-detail { margin: 5px 0; color: #666; }
      </style>
    </head>
    <body>
      <h1>LAPORAN TUGAS TAMBAHAN</h1>
      <h2>Periode: Desember 2024</h2>
      
      <div class="task">
        <div class="task-name">1. Rapat Koordinasi Pengawas Sekolah</div>
        <div class="task-detail">üìÖ Tanggal: 15 Desember 2024</div>
        <div class="task-detail">üìç Lokasi: Kantor Dinas Pendidikan Provinsi Jawa Barat</div>
        <div class="task-detail">üè¢ Penyelenggara: Dinas Pendidikan Provinsi Jawa Barat</div>
      </div>
      
      <div class="task">
        <div class="task-name">2. Workshop Implementasi Kurikulum Merdeka</div>
        <div class="task-detail">üìÖ Tanggal: 18 Desember 2024</div>
        <div class="task-detail">üìç Lokasi: LPMP Jawa Barat, Bandung</div>
        <div class="task-detail">üè¢ Penyelenggara: LPMP Jawa Barat</div>
      </div>
      
      <div class="task">
        <div class="task-name">3. Supervisi Akademik Terpadu</div>
        <div class="task-detail">üìÖ Tanggal: 20 Desember 2024</div>
        <div class="task-detail">üìç Lokasi: SMKN 4 Garut</div>
        <div class="task-detail">üè¢ Penyelenggara: Pengawas Sekolah Wilayah III</div>
      </div>
      
      <div class="task">
        <div class="task-name">4. Bimbingan Teknis Penyusunan RPS</div>
        <div class="task-detail">üìÖ Tanggal: 22 Desember 2024</div>
        <div class="task-detail">üìç Lokasi: Hotel Savoy Homann, Bandung</div>
        <div class="task-detail">üè¢ Penyelenggara: Balai Diklat Keagamaan</div>
      </div>
      
      <div class="task">
        <div class="task-name">5. Evaluasi Program Sekolah Penggerak</div>
        <div class="task-detail">üìÖ Tanggal: 25 Desember 2024</div>
        <div class="task-detail">üìç Lokasi: Gedung Sate, Bandung</div>
        <div class="task-detail">üè¢ Penyelenggara: Kemendikbudristek</div>
      </div>
      
      <div class="task">
        <div class="task-name">6. Sosialisasi Asesmen Nasional</div>
        <div class="task-detail">üìÖ Tanggal: 28 Desember 2024</div>
        <div class="task-detail">üìç Lokasi: Aula LPMP Jawa Barat</div>
        <div class="task-detail">üè¢ Penyelenggara: Pusat Asesmen dan Pembelajaran</div>
      </div>
      
      <script>window.onload = function() { window.print(); }</script>
    </body>
    </html>
  `;
  printWindow.document.write(html);
  printWindow.document.close();
}

// Jalankan function
forcePDFExport();
            </div>
        </div>
    </div>

    <script>
        function forceCreateData() {
            const year = '2024';
            const month = '12';
            
            const additionalTasks = [
                {
                    id: "force-task-1",
                    name: "Rapat Koordinasi Pengawas Sekolah",
                    date: `${year}-${month}-15`,
                    location: "Kantor Dinas Pendidikan Provinsi Jawa Barat",
                    organizer: "Dinas Pendidikan Provinsi Jawa Barat",
                    description: "Rapat koordinasi bulanan membahas program supervisi sekolah",
                    createdAt: `${year}-${month}-15T10:00:00.000Z`
                },
                {
                    id: "force-task-2",
                    name: "Workshop Implementasi Kurikulum Merdeka",
                    date: `${year}-${month}-18`,
                    location: "LPMP Jawa Barat, Bandung",
                    organizer: "LPMP Jawa Barat",
                    description: "Workshop pelatihan implementasi kurikulum merdeka",
                    createdAt: `${year}-${month}-18T09:00:00.000Z`
                },
                {
                    id: "force-task-3",
                    name: "Supervisi Akademik Terpadu",
                    date: `${year}-${month}-20`,
                    location: "SMKN 4 Garut",
                    organizer: "Pengawas Sekolah Wilayah III",
                    description: "Kegiatan supervisi akademik terpadu",
                    createdAt: `${year}-${month}-20T08:00:00.000Z`
                },
                {
                    id: "force-task-4",
                    name: "Bimbingan Teknis Penyusunan RPS",
                    date: `${year}-${month}-22`,
                    location: "Hotel Savoy Homann, Bandung",
                    organizer: "Balai Diklat Keagamaan",
                    description: "Bimbingan teknis penyusunan RPS",
                    createdAt: `${year}-${month}-22T13:00:00.000Z`
                },
                {
                    id: "force-task-5",
                    name: "Evaluasi Program Sekolah Penggerak",
                    date: `${year}-${month}-25`,
                    location: "Gedung Sate, Bandung",
                    organizer: "Kemendikbudristek",
                    description: "Evaluasi program sekolah penggerak",
                    createdAt: `${year}-${month}-25T14:00:00.000Z`
                },
                {
                    id: "force-task-6",
                    name: "Sosialisasi Asesmen Nasional",
                    date: `${year}-${month}-28`,
                    location: "Aula LPMP Jawa Barat",
                    organizer: "Pusat Asesmen dan Pembelajaran",
                    description: "Sosialisasi Asesmen Nasional 2025",
                    createdAt: `${year}-${month}-28T10:00:00.000Z`
                }
            ];
            
            // FORCE SAVE dengan multiple keys
            localStorage.setItem('additional_tasks_data', JSON.stringify(additionalTasks));
            localStorage.setItem('additional_tasks_data_backup', JSON.stringify(additionalTasks));
            localStorage.setItem('additional_tasks_data_timestamp', Date.now().toString());
            localStorage.setItem('additionalTasks', JSON.stringify(additionalTasks)); // Alternative key
            
            document.getElementById('fixResults').innerHTML = `
                <div class="success">
                    ‚úÖ FORCE DATA CREATED!<br>
                    - Dibuat 6 tugas tambahan untuk Desember 2024<br>
                    - Data disimpan dengan multiple keys<br>
                    - Timestamp: ${new Date().toLocaleString('id-ID')}
                </div>
            `;
        }

        function forceFixLocalStorage() {
            // Clear semua data lama
            localStorage.removeItem('additional_tasks_data');
            localStorage.removeItem('additional_tasks_data_backup');
            localStorage.removeItem('additionalTasks');
            
            // Tunggu sebentar
            setTimeout(() => {
                forceCreateData();
                
                document.getElementById('fixResults').innerHTML += `
                    <div class="success">
                        ‚úÖ LOCALSTORAGE FIXED!<br>
                        - Cleared old data<br>
                        - Created fresh data<br>
                        - Ready for testing
                    </div>
                `;
            }, 500);
        }

        function testDataLoad() {
            const data1 = localStorage.getItem('additional_tasks_data');
            const data2 = localStorage.getItem('additionalTasks');
            
            let result = '';
            if (data1) {
                const parsed = JSON.parse(data1);
                result += `‚úÖ additional_tasks_data: ${parsed.length} items<br>`;
            } else {
                result += `‚ùå additional_tasks_data: Not found<br>`;
            }
            
            if (data2) {
                const parsed = JSON.parse(data2);
                result += `‚úÖ additionalTasks: ${parsed.length} items<br>`;
            } else {
                result += `‚ùå additionalTasks: Not found<br>`;
            }
            
            document.getElementById('fixResults').innerHTML = `
                <div class="success">
                    üìä DATA TEST RESULTS:<br>
                    ${result}
                </div>
            `;
        }

        function openReportsPage() {
            window.open('http://localhost:5000/reports', '_blank');
        }

        // Auto-run on load
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-create data if not exists
            if (!localStorage.getItem('additional_tasks_data')) {
                forceCreateData();
            }
        });
    </script>
</body>
</html>